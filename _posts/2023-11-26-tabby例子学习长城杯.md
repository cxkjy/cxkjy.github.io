---
layout: post
title: hashmapååºåˆ—åŒ–#equals
categories: [blog ]
tags: [Java,]
description: ""
image:
  feature: windows.jpg
  credit: JYcxk
  creditlink: 
---





### å‰è¨€

```java
æœ€è¿‘å‘ç°è‡ªå·±å¯¹æ‰“CTFçš„çƒ­æƒ…é€æ¸å‡å°‘äº†ï¼ˆå¯èƒ½æ˜¯è‡ªå·±å¤§ä¸‰äº†å”‰è€äº†ï¼‰ï¼Œä½†å´å¯¹è¯¾æœ¬è¶Šæ¥è¶Šæ„Ÿå…´è¶£äº†ï¼Œä½†å¯¹æˆ‘çš„javaçƒ­æƒ…ä¹Ÿæå…·å¢é«˜ï¼Œå°¤å…¶æ˜¯æœ€è¿‘å¤šäº†tabbyè¿™ä¸ªçˆ±å¦ƒé«˜å…´äº†å¥½å‡ å¤©äº†ï¼Œæ¥ä¸‹æ¥å°±å­¦å­¦å¦‚ä½•ä½¿ç”¨å¥¹
```

### æ­£æ–‡

ğŸ˜âœŒçœŸå¥½é™„ä»¶ç›´æ¥ç»™å‡ºäº†ï¼Œä¸ç”¨è´¹å·¥å¤«å»æ‰¾é™„ä»¶äº†ã€‚

å¤‡ç”¨ï¼š[b4bycoffee_f18028284cae793d0b1da80146f01bd0.zip](https://l3yx.github.io/resource/b4bycoffee_f18028284cae793d0b1da80146f01bd0.zip)

```java
rome 1.7
Springboot
jackson
```

è€ƒå¯Ÿçš„romeååºåˆ—åŒ–ï¼Œromeç»å…¸æ‰“æ³•å°±æ˜¯ç›´æ¥ signObjectäºŒæ¬¡ååºåˆ—åŒ–

![image-20231126180340425](X:\github\cxkjy.github.io\cxkjy.github.io\img\final\image-20231126180340425.png)

#### Hashmap+Rome

```java
HashMap::readObject->hash->key.hashcode
ObjectBean::hashCode
       EqualsBean::beanHashCode
                     ObjectBean::toString()
                            ToStringBean::toString() 
                                   ToStringBean::toString()æ–¹æ³•ä¸­çš„ invokeæ‰§è¡Œ
```

#### äºŒæ¬¡ååºåˆ—åŒ–

 ```java
 getObject:177, SignedObject (java.security)
 invoke0:-1, NativeMethodAccessorImpl (sun.reflect)
 invoke:62, NativeMethodAccessorImpl (sun.reflect)
 invoke:43, DelegatingMethodAccessorImpl (sun.reflect)
 invoke:498, Method (java.lang.reflect)
 beanEquals:146, EqualsBean (com.sun.syndication.feed.impl)
 equals:103, EqualsBean (com.sun.syndication.feed.impl)
 equals:495, AbstractMap (java.util)
 reconstitutionPut:1241, Hashtable (java.util)
 readObject:1215, Hashtable (java.util)
 ```



### æˆ‘å°±è¯´å¥½ç†Ÿæ‚‰ï¼Œæœä¸å…¶ç„¶å‰å‡ å¤©åˆšé‡åˆ°ï¼Œæˆ‘ä¸¢è¿™å‡ºé¢˜åªæŠŠkryoåºåˆ—åŒ–æ”¹æˆäº†æ™®é€šçš„åºåˆ—åŒ–ï¼ï¼ï¼

![image-20231126182642622](X:\github\cxkjy.github.io\cxkjy.github.io\img\final\image-20231126182642622.png)

ä¸Šæ¬¡çš„é¢˜æ˜¯ kryo+romeäºŒæ¬¡ååºåˆ—åŒ–åšçš„ï¼Œè¿™é“é¢˜å¤šäº†ä¸€ä¸ªé»‘åå•çš„é™åˆ¶

![image-20231126182906479](X:\github\cxkjy.github.io\cxkjy.github.io\img\final\image-20231126182906479.png)

å¯¹æ¯”è€Œè¨€å¡çš„æ˜¯äºŒæ¬¡ååºåˆ—åŒ–åé¢çš„ç±»ï¼ŒäºŒæ¬¡ååºåˆ—åŒ–è¿˜æ˜¯å¯ä»¥æ­£å¸¸æ‰§è¡Œçš„

### `æ­¤æ—¶ç–‘é—®ï¼šäºŒæ¬¡ååºåˆ—åŒ–çš„é“¾å­è¿˜ä¼šè¢«æ‹¦æˆªå˜›`

è¯•äº†è¿™ç§resolveClassæ˜¯ä¼šè¢«æ‹¦æˆªçš„

![image-20231126193430531](X:\github\cxkjy.github.io\cxkjy.github.io\img\final\image-20231126193430531.png)

é‚£å°±æ˜¯æ”¹è¿™ä¸ªäºŒæ¬¡ååºåˆ—åŒ–åçš„ç»“æœï¼Œéƒ½ç¦äº†ã€‚ã€‚ã€‚

```java
HashMap::readObject->hash->key.hashcode
ObjectBean::hashCode
       EqualsBean::beanHashCode
                     ObjectBean::toString()
                            ToStringBean::toString() 
                                   ToStringBean::toString()æ–¹æ³•ä¸­çš„ invokeæ‰§è¡Œ
```

æ‰¾äº†ä¸€ä¸‹hessianåŸç”Ÿjdké“¾å­ç¼ºå°‘ä¾èµ–ä¹Ÿæ‰“ä¸é€š

## æ²¡æ€è·¯äº†çœ‹çœ‹å…¶ä»–ç»™å‡ºçš„ç±» 

ç»™äº†ä¸€ä¸ªCoffeeBeanç±»å®ç°åºåˆ—åŒ– æ¥å£ï¼Œå¹¶ä¸”æœ‰toStringæ–¹æ³•å¯ä»¥æ‰§è¡Œä»»ä½•ä»£ç ï¼Œæ‰€ä»¥å‡ºå£è‚¯å®šæ˜¯è°ƒç”¨CoffeeBean#toStringæ–¹æ³•ï¼Œå¹¶ä¸”åå°„ä¿®æ”¹ClassByteçš„å€¼

```java
public class CoffeeBean extends ClassLoader implements Serializable {
    private String name = "Coffee bean";
    private byte[] ClassByte;

    public String getName() {
        return this.name;
    }

    public void setName(String name) {
        this.name = name;
    }

    @Override // java.lang.Object
    public String toString() {
        try {
            new CoffeeBean().defineClass(null, this.ClassByte, 0, this.ClassByte.length).newInstance();
            return "A cup of Coffee --";
        } catch (IllegalAccessException var6) {
            var6.printStackTrace();
            return "A cup of Coffee --";
        } catch (InstantiationException var5) {
            var5.printStackTrace();
            return "A cup of Coffee --";
        }
    }
}
```

```java
HashMap::readObject->hash->key.hashcode
EqualsBean::hashCode//ä¹Ÿæ²¡äº†
       EqualsBean::beanHashCode  //åˆ°è¿™é‡Œéƒ½æ²¡è¢«è¿‡æ»¤
           
           
           
                     ObjectBean::toString()  //ä¸‹é¢å…¨è¿‡æ»¤äº†
                            ToStringBean::toString() 
                                   ToStringBean::toString()æ–¹æ³•ä¸­çš„ invokeæ‰§è¡Œ
```

ï¼Ÿï¼Ÿï¼Ÿè¿™ä¸æ˜¯ç›´æ¥é€šäº†å˜›è¿™æ¡é“¾å­

```java
HashMap#readObject
    EqualsBean#hashCode
       EqualsBean#beanHashCode
            CoffeeBean#toString
æ— è¯­ã€‚ã€‚ã€‚çƒ‚é¢˜
```

![image-20231126201132614](X:\github\cxkjy.github.io\cxkjy.github.io\img\final\image-20231126201132614.png)
